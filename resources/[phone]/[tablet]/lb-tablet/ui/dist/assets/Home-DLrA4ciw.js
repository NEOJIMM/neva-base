import{j as i,m as g,a as o,K as b,u as p,r as d,h as C,bF as I,G as P,L as a,bG as B,bH as f,o as w,H as D,bf as R,a8 as T,k as M,g as O,aD as W,bI as x,bJ as F,$ as N,bK as $,bL as j}from"./index-B-vcvQz_.js";import{ActiveWarrant as k}from"./Warrants-XdZHY-v5.js";const H=b([]),h=b([]),U=b([]),A=b([]),q=(t,l)=>{switch(t){case"getReport":return I.reports.find(r=>r.id===l);case"getWarrant":return I.warrants.find(r=>r.id===l);default:return null}},_=(t,l)=>{if(!l)return P("error","No ID provided");C("Police",{action:t,id:l},q(t,l)).then(r=>{if(!r)return P("error",`Failed to fetch ${t} with ID: ${l}`);switch(t){case"getReport":B.set(r),f.set("reports");break;case"getWarrant":k.set(r),f.set("warrants");break;default:P("error",`Unknown event: ${t}`);break}})};function Y(){return i(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:i("main",{className:"main",style:{padding:"0"},children:o("div",{className:"grid",children:[i(G,{}),i(K,{}),i(J,{}),i(z,{})]})})})}const G=()=>{var m;const t=p(H),l=p(N.APPS.POLICE.permissions),[r,s]=d.useState(""),[c,E]=d.useState("");return d.useEffect(()=>{const e=setTimeout(()=>s(c),500);return()=>clearTimeout(e)},[c]),d.useEffect(()=>{C("Police",{action:"getReports",query:r},I.reports.filter(e=>e.title.toLowerCase().includes(r.toLowerCase())||e.description.toLowerCase().includes(r.toLowerCase()))).then(e=>{if(!e)return P("warning","getReports did not return any data");H.set(e)})},[r]),o("div",{className:"grid-item",children:[o("div",{className:"top",children:[i("div",{className:"title",children:a("APPS.POLICE.HOME.RECENT_REPORTS")}),((m=l==null?void 0:l.report)==null?void 0:m.create)&&o("div",{className:"button",onClick:()=>{B.set({}),f.set("reports")},children:[i(w,{}),a("APPS.POLICE.HOME.CREATE")]})]}),i(D,{placeholder:a("APPS.POLICE.REPORTS.SEARCH"),onChange:e=>E(e.target.value)}),i("div",{className:"items",children:t.map(e=>i(g.div,{...R,className:"item home",onClick:()=>_("getReport",e.id),children:o("div",{className:"item-content",children:[i("div",{className:"item-title",children:e.title}),i("div",{className:"item-subtitle",children:e.description.length>100?e.description.substring(0,100)+"...":e.description}),i("div",{className:"item-footer",children:a("APPS.POLICE.HOME.REPORT_FOOTER",{timestamp:T(e.lastUpdated),author:e.author})})]})},e.id))})]})},K=()=>{var e;const t=p($),l=p(h),r=p(N.APPS.POLICE.permissions),[s,c]=d.useState(""),[E,m]=d.useState("");return d.useEffect(()=>{const n=setTimeout(()=>c(E),500);return()=>clearTimeout(n)},[E]),d.useEffect(()=>{C("Police",{action:"getBulletinBoard",query:s},I.bulletinBoard.filter(n=>n.title.toLowerCase().includes(s.toLowerCase())||n.content.toLowerCase().includes(s.toLowerCase()))).then(n=>{if(!n)return P("warning","getBulletinBoard did not return any data");h.set(n)})},[s]),M("police:bulletinDeleted",n=>{if(!n)return P("error","No ID provided in bulletinDeleted event");h.set(h.value.filter(u=>u.id!==n))}),o("div",{className:"grid-item full",children:[o("div",{className:"top",children:[i("div",{className:"title",children:a("APPS.POLICE.HOME.BULLETIN_BOARD")}),((e=r==null?void 0:r.bulletin)==null?void 0:e.create)&&o("div",{className:"button",onClick:()=>{let n,u;O.PopUp.set({title:a("APPS.POLICE.HOME.ADD_BULLETIN.TITLE"),description:a("APPS.POLICE.HOME.ADD_BULLETIN.DESCRIPTION"),input:{placeholder:a("APPS.POLICE.HOME.ADD_BULLETIN.PLACEHOLDER"),onChange:L=>{O.PopUp.value.buttons[0].disabled=L.length<1,n=L}},textarea:{placeholder:a("APPS.POLICE.HOME.ADD_BULLETIN.CONTENT"),onChange:L=>{O.PopUp.value.buttons[0].disabled=L.length<1,u=L}},buttons:[{title:a("APPS.POLICE.HOME.ADD_BULLETIN.CANCEL")},{title:a("APPS.POLICE.HOME.ADD_BULLETIN.PROCEED"),cb:()=>{if(!n||!u)return P("error","Input or Textarea is empty");if(n.length<1||u.length<1)return P("error","Input or Textarea is empty");C("Police",{action:"createBulletin",title:n,content:u},Math.random().toString(36).substring(7)).then(L=>{if(!L)return P("error","Failed to create bulletin");let y=[...h.value,{id:L,title:n,content:u,timestamp:Date.now(),author:t.name,pinned:!1}].sort((S,v)=>S.timestamp===v.timestamp?0:S.timestamp>v.timestamp?-1:1).sort((S,v)=>S.pinned===v.pinned?0:S.pinned?-1:1);h.set(y)})}}]})},children:[i(w,{}),a("APPS.POLICE.ADD")]})]}),i(D,{placeholder:a("APPS.POLICE.HOME.SEARCH_BULLETIN"),onChange:n=>m(n.target.value)}),i("div",{className:"items full",children:l.sort((n,u)=>n.timestamp===u.timestamp?0:n.timestamp>u.timestamp?-1:1).sort((n,u)=>n.pinned===u.pinned?0:n.pinned?-1:1).filter(n=>n.title.toLowerCase().includes(s.toLowerCase())||n.content.toLowerCase().includes(s.toLowerCase())).map((n,u)=>i(V,{data:n},u))})]})},V=({data:t})=>{p(j);const l=W(()=>{var r,s,c;!((r=N.APPS.POLICE.permissions.value)!=null&&r.bulletin.pin)&&!(t!=null&&t.created)||O.ContextMenu.set({buttons:[((s=N.APPS.POLICE.permissions.value)==null?void 0:s.bulletin.pin)&&{title:t.pinned?a("APPS.POLICE.HOME.UNPIN"):a("APPS.POLICE.HOME.PIN"),color:t.pinned?"red":null,cb:()=>{C("Police",{action:"toggleBulletinPinned",id:t.id,pinned:!t.pinned},!0).then(E=>{if(!E)return P("error","Failed to toggle pinned bulletin");h.set(h.value.map(m=>m.id===t.id?{...m,pinned:!m.pinned}:m))})}},(t.created||((c=N.APPS.POLICE.permissions.value)==null?void 0:c.bulletin.delete))&&{title:a("APPS.POLICE.HOME.DELETE_BULLETIN.DELETE"),color:"red",cb:()=>{O.PopUp.set({title:a("APPS.POLICE.HOME.DELETE_BULLETIN.TITLE"),description:a("APPS.POLICE.HOME.DELETE_BULLETIN.DESCRIPTION"),buttons:[{title:a("APPS.POLICE.CANCEL")},{title:a("APPS.POLICE.DELETE"),color:"red",cb:()=>{C("Police",{action:"deleteBulletin",id:t.id}).then(E=>{if(!E)return P("error","Failed to delete bulletin");h.set(h.value.filter(m=>m.id!==t.id))})}}]})}}]})});return i(g.div,{...R,...l,className:"item home",onClick:()=>{x.set({title:t.title,content:t.content,footer:`${T(t.timestamp)} - ${t.author}`})},children:o("div",{className:"item-content",children:[t.pinned&&i(F,{}),i("div",{className:"item-title",children:t.title}),i("div",{className:"item-subtitle",children:t.content}),o("div",{className:"item-footer",children:[T(t.timestamp)," - ",t.author]})]})})},z=()=>{var m;const t=p(U),l=p(N.APPS.POLICE.permissions),[r,s]=d.useState(""),[c,E]=d.useState("");return d.useEffect(()=>{const e=setTimeout(()=>s(c),500);return()=>clearTimeout(e)},[c]),d.useEffect(()=>{C("Police",{action:"getWarrants",query:r},I.warrants.filter(e=>e.title.toLowerCase().includes(r.toLowerCase())||e.description.toLowerCase().includes(r.toLowerCase()))).then(e=>{if(!e)return P("warning","getReports did not return any data");U.set(e)})},[r]),o("div",{className:"grid-item",children:[o("div",{className:"top",children:[i("div",{className:"title",children:a("APPS.POLICE.HOME.RECENT_WARRANTS")}),((m=l==null?void 0:l.warrant)==null?void 0:m.create)&&o("div",{className:"button",onClick:()=>{k.set({}),f.set("warrants")},children:[i(w,{}),a("APPS.POLICE.HOME.CREATE")]})]}),i(D,{placeholder:a("APPS.POLICE.WARRANTS.SEARCH"),onChange:e=>E(e.target.value)}),i("div",{className:"items",children:t.map(e=>d.createElement(g.div,{...R,key:e.id,className:"item home",onClick:()=>{_("getWarrant",e.id)}},o("div",{className:"item-content",children:[i("div",{className:"item-title",children:e.title}),i("div",{className:"item-subtitle",children:e.description.substring(0,100)}),o("div",{className:"item-footer",children:[T(e.lastUpdated)," - ",e.author]})]})))})]})},J=()=>{const t=p(A),[l,r]=d.useState("");return d.useEffect(()=>{C("Police",{action:"getActiveUnits"},I.activeUnits).then(s=>{if(!s)return P("warning","getActiveUnits did not return any data");A.set(s)})},[]),M("police:updateCallsign",s=>{if(!s)return P("error","No data received for police:updateCallsign");A.set(A.value.map(c=>c.source===s.source?{...c,callsign:s.callsign}:c))}),o("div",{className:"grid-item full",children:[i("div",{className:"top",children:i("div",{className:"title",children:a("APPS.POLICE.HOME.ACTIVE_UNITS")})}),i(D,{placeholder:a("APPS.POLICE.HOME.SEARCH_UNITS"),onChange:s=>r(s.target.value)}),i("div",{className:"items full",children:t.filter(s=>{var c;return((c=s==null?void 0:s.callsign)==null?void 0:c.toLowerCase().includes(l.toLowerCase()))||(s==null?void 0:s.name.toLowerCase().includes(l.toLowerCase()))}).map((s,c)=>o(g.div,{...R,className:"item unit",children:[s.callsign&&i("div",{className:"card green",children:s.callsign}),i("div",{className:"card blue",children:s.rank}),i("div",{className:"name",children:s.name})]},c))})]})};export{Y as default};
