import{r as g,a as C,F as ee,j as t,an as de,K as q,L as i,ax as ue,ay as Pe,az as me,aA as he,aB as ve,u as R,U as K,$ as f,G as v,h as b,aC as _,aD as fe,m as F,n as ne,o as Ae,ac as X,aE as Se,av as j,aF as se,q as Oe,g as L,J as re,f as J,aG as Ce,aj as le,ap as ge,aH as Ee,C as W,a4 as te,a3 as oe,aI as ae,a6 as pe,N as Te,a5 as Q,aJ as be,aK as Me,aL as Ie,S as ce,aM as Ne}from"./index-B-vcvQz_.js";const $=({src:o,showAdvanced:c})=>{const[s,S]=g.useState(null);return C(ee,{children:[t("video",{src:o,crossOrigin:"anonymous",controls:!1,onMouseOver:I=>{c&&I.currentTarget.play()},onMouseOut:I=>{c&&I.currentTarget.pause()},muted:!0,loop:!0,onLoadedMetadata:I=>{S(I.currentTarget.duration)}}),s&&c&&t("div",{className:"video-duration",children:(I=>{const M=Math.floor(I/60),A=de(I-M*60,0);return`${M}:${A<10?"0"+A:A}`})(s)})]})},H=q(null),z=[{title:i("APPS.PHOTOS.VIDEOS"),id:"videos",icon:t(ue,{}),count:0},{title:i("APPS.PHOTOS.SELFIES"),id:"selfies",icon:t(Pe,{}),count:0},{title:i("APPS.PHOTOS.SCREENSHOTS"),id:"screenshots",icon:t(me,{}),count:0},{title:i("APPS.PHOTOS.IMPORTS"),id:"imports",icon:t(he,{}),count:0},{title:i("APPS.PHOTOS.DUPLICATES"),id:"duplicates",icon:t(ve,{}),count:0}];function ye(){const o=R(H),[c,s]=g.useState(!1),S=R(f.APPS.CAMERA.albums),p=R(f.APPS.CAMERA.mediaTypes),I=R(pe),M=R(Te),A=g.useRef(null);g.useEffect(()=>{var u,O;if(K("Photos")){if(((u=f.APPS.CAMERA.albums.value)==null?void 0:u.length)>0&&((O=f.APPS.CAMERA.mediaTypes.value)==null?void 0:O.length)>0)return v("info","Album and mediatype cache exists, returning");b("Camera",{action:"getAlbums"},{albums:_.Albums,mediaTypes:_.MediaTypes}).then(T=>{if(!T)return v("error","No data received from server");let e=(p.length>0?p:z).map(n=>{const a=T.mediaTypes[n.id+"Photos"]??0,r=T.mediaTypes[n.id+"Videos"]??0;return{...n,count:a+r,videoCount:r,photoCount:a}});f.APPS.CAMERA.albums.set(T.albums),f.APPS.CAMERA.mediaTypes.set(e)})}},[o]),g.useEffect(()=>{if(!K("Photos"))return;let u=S.find(O=>O.id==="phone");I?b("Camera",{action:"getPhoneAlbum"},{cover:_.PhonePhotos[0].src,count:_.PhonePhotos.length,photoCount:_.PhonePhotos.filter(O=>!O.isVideo).length,videoCount:_.PhonePhotos.filter(O=>O.isVideo).length}).then(O=>{if(!O)return v("error","No data received from server");O.id="phone",O.title="From my phone",O.removable=!1,setTimeout(()=>{u?f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(T=>T.id==="phone"?O:T)):f.APPS.CAMERA.albums.set([...f.APPS.CAMERA.albums.value,O])},100)}):setTimeout(()=>{u&&f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.filter(O=>O.id!=="phone"))},100)},[M==null?void 0:M.active]),g.useEffect(()=>A!=null&&A.current?(A.current.addEventListener("wheel",u=>{u.preventDefault(),A.current.scrollLeft+=u.deltaY}),()=>{A!=null&&A.current&&(A==null||A.current.removeEventListener("wheel",u=>{u.preventDefault(),A.current.scrollLeft+=u.deltaY}))}):v("warning","Scroll container not found"),[A==null?void 0:A.current]);const w=()=>{let u="";L.PopUp.set({title:i("APPS.PHOTOS.NEW_ALBUM_POPUP.TITLE"),description:i("APPS.PHOTOS.NEW_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:i("APPS.PHOTOS.NEW_ALBUM_POPUP.PLACEHOLDER"),maxCharacters:20,onChange:O=>{u=O}},buttons:[{title:i("APPS.PHOTOS.NEW_ALBUM_POPUP.CANCEL")},{title:i("APPS.PHOTOS.NEW_ALBUM_POPUP.PROCEED"),cb:()=>{b("Camera",{action:"createAlbum",title:u},{id:Math.floor(Math.random()*1e3).toString()}).then(O=>{if(!O)return v("warning","Could not create album, id not returned");if(u.length<1)return v("warning","Input is empty, cannot create album");if(u.length>20)return v("warning","Input is too long, cannot create album");let T={title:u,id:O,cover:null,count:0,photoCount:0,videoCount:0};f.APPS.CAMERA.albums.set([...S,T])})}}]})},m=u=>{if(!u)return v("warning","No album id provided, cannot remove album");L.PopUp.set({title:i("APPS.PHOTOS.REMOVE_ALBUM.TITLE",{name:u.title}),description:i("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION",{name:u.title}),buttons:[{title:i("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:i("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{b("Camera",{action:"deleteAlbum",id:u.id},!0).then(O=>{if(!O)return v("error","Could not remove album, server returned false");f.APPS.CAMERA.albums.set(S.filter(T=>T.id!==u.id))})}}]})},B=u=>u?u.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):0,k=fe(u=>{let O=u.target;for(;!O.classList.contains("album");)O=O.parentElement;let T=O.getAttribute("data-id");if(!T)return v("warning","Could not obtain album id from element");T==="favourites"||T==="recents"||T==="phone"||L.ContextMenu.set({buttons:[{title:i("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let E="";L.PopUp.set({title:i("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:i("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:i("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:e=>{E=e}},buttons:[{title:i("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:i("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(E.length<1)return v("warning","Input is empty, cannot rename album");v("warning","Renaming album",T,E),b("Camera",{action:"renameAlbum",id:T,title:E},!0).then(e=>{if(!e)return v("error","Could not rename album, server returned false");f.APPS.CAMERA.albums.set(S.map(n=>n.id===T?{...n,title:E}:n))})}}]})}},{title:i("APPS.PHOTOS.DELETE"),color:"red",cb:()=>m(S.find(E=>E.id===T))}]})});return t(F.div,{...ne("right",o?"inAlbum":"albums"),style:{height:"100%",paddingBottom:"9rem"},children:o?t(X,{children:t(Re,{})}):C(ee,{children:[C("div",{className:"albums-header",children:[C("div",{className:"top",children:[t(Ae,{onClick:w}),t("div",{className:"edit",onClick:()=>s(!c),children:c?i("APPS.PHOTOS.DONE"):i("APPS.PHOTOS.EDIT")})]}),t("div",{className:"title",children:i("APPS.PHOTOS.ALBUMS")})]}),C("div",{className:"albums-content",children:[t("div",{className:"subtitle",children:i("APPS.PHOTOS.MY_ALBUMS")}),t("div",{className:"albums-grid","data-edit":c,ref:A,style:{overflowX:S.length>8?"auto":"hidden"},children:t(X,{children:S.map((u,O)=>C(F.div,{animate:{scale:1},exit:{scale:.2},transition:{duration:.25,ease:"easeInOut"},className:"album","data-id":u.id,"data-removable":u.removable,...k,onClick:()=>{c||H.set(u)},children:[c&&u.removable!==!1&&t("div",{className:"remove",onClick:T=>{T.stopPropagation(),m(u)},children:t(Se,{})}),C("div",{className:"cover",children:[j(u.cover)?t($,{src:u.cover,showAdvanced:!1}):t("img",{src:u.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"}),u.id==="favourites"&&t(se,{})]}),C("div",{className:"text",children:[t("div",{className:"title",children:u.title}),t("div",{className:"count",children:B(u.count)})]})]},O))})})]}),t("div",{className:"divider"}),C("div",{className:"media-types",children:[t("div",{className:"subtitle",children:i("APPS.PHOTOS.MEDIA_TYPES")}),t("div",{className:"media-types-items",children:p.map((u,O)=>C("div",{className:"item",onClick:()=>{if(c)return v("info","Edit mode is enabled, cannot open media type");H.set({...u,id:null,cover:null,type:u.id})},children:[C("div",{className:"type",children:[u.icon,u.title]}),C("div",{className:"action",children:[t("div",{className:"count",children:u.count}),t(Oe,{})]})]},O))})]})]})})}const Re=()=>{var O,T;const o=R(H),c=R(U),[s,S]=g.useState([]),[p,I]=g.useState([]),[M,A]=g.useState(!1),[w,m]=g.useState(!1),[B,k]=g.useState(!1);g.useEffect(()=>{let E=o.id==="favourites"?_.Photos.filter(e=>e.favourite):o.id==="recents"?_.Photos:o.type==="videos"?_.Photos.filter(e=>e.isVideo):o.type?_.Photos.filter(e=>e.type===o.type):_.Photos.filter(e=>e.album===o.id)?o.id==="phone"?_.PhonePhotos:_.Photos.filter(e=>e.album===o.id):[];b("Camera",{action:"getImages",filter:o.id!=="phone"?{album:o.id,type:o.type}:null},E,o.id==="phone").then(e=>{if(!e)return v("warning","No data was returned from getImages event");I(e.reverse()),A(e.length===0)})},[]);const u=E=>{if(w||B)return;let e=document.querySelector("#last");if(!e)return;if(!Q(e)){const a=document.querySelector(".library-content");a||v("warning","Could not find library content element");const r=a==null?void 0:a.scrollHeight;k(!0),b("Camera",{action:"getImages",lastId:p[p.length-1].id,filter:o.id!=="phone"?{album:o.id,type:o.type}:{perPage:30}},null,o.id==="phone").then(P=>{P&&P.length>0?(a.style.transform=`translateY(${r}px)`,I(N=>[...P.reverse(),...N]),k(!1),requestAnimationFrame(()=>{a.style.transition="transform 0ms",a.style.transform="translateY(0)"}),P.length<30&&m(!0)):m(!0)})}};return C(F.div,{initial:{opacity:0,x:35},animate:{opacity:1,x:0},exit:{opacity:0,x:35},transition:{duration:.25,ease:"easeInOut"},children:[C("div",{className:"library-header",children:[C("div",{className:"top",children:[t("div",{className:"info",children:C("div",{className:"back",style:{color:p.length<15?"var(--phone-color-blue)":"#ffffff"},onClick:()=>{c&&U.set(!1),H.set(null)},children:[t(re,{}),i("APPS.PHOTOS.ALBUMS")]})}),C("div",{className:"actions",style:{color:p.length<15?"var(--phone-color-blue)":"var(--phone-text-primary)"},children:[t("div",{className:"button",onClick:()=>U.set(!c),children:c?i("APPS.PHOTOS.DONE"):i("APPS.PHOTOS.SELECT")}),((T=(O=J.value)==null?void 0:O.AllowExternal)==null?void 0:T.Gallery)||o.id!=="favourites"&&o.id!=="recents"&&o.id!=="phone"&&t("div",{className:"button round",onClick:()=>{var n,a;let E=o.id!=="recents"&&o.id!=="favourites",e=((a=(n=J.value)==null?void 0:n.AllowExternal)==null?void 0:a.Gallery)&&o.id!=="favourites";if(!E&&!e)return v("warning","Cannot edit or import images in this album");L.ContextMenu.set({buttons:[e&&{title:i("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),cb:()=>{let r="";L.PopUp.set({title:i("APPS.PHOTOS.IMPORT_IMAGE_POPUP.TITLE"),description:i("APPS.PHOTOS.IMPORT_IMAGE_POPUP.DESCRIPTION"),input:{placeholder:i("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PLACEHOLDER"),onChange:P=>{r=P}},buttons:[{title:i("APPS.PHOTOS.IMPORT_IMAGE_POPUP.CANCEL")},{title:i("APPS.PHOTOS.IMPORT_IMAGE_POPUP.PROCEED"),cb:()=>{if(r.includes("data:image"))return v("warning","Data URL not supported");if(!Ce(r)){setTimeout(()=>{L.PopUp.set({title:i("COMPONENTS.GALLERY.EXTERNAL_URL"),description:i("COMPONENTS.GALLERY.EXTERNAL_URL_BLACKLISTED"),buttons:[{title:"OK"}]}),v("warning","External URL is blacklisted")},500);return}le(r,P=>{if(!P)return v("error","Image does not exist");ge(r,null,"import",!0).then(N=>{if(!N)return v("error","Could not save to gallery, server returned false");let d=j(r);I([{id:N,src:r,timestamp:Date.now(),type:"import",isVideo:d},...p]),o.id!=="recents"&&o.id!=="favourites"?b("Camera",{action:"addToAlbum",album:o.id,ids:[N]}).then(l=>{if(!l)return v("error","Could not add to album, server returned false");let h=o.photoCount+1,y=d?o.videoCount+1:o.videoCount;H.set({...o,photoCount:h,videoCount:y,cover:r})}):o.id==="favourites"&&b("Camera",{action:"toggleFavourites",ids:[N],favourite:!0}).then(l=>{if(!l)return v("error","Could not add to favourites, server returned false");let h=o.photoCount+1,y=d?o.videoCount+1:o.videoCount;H.set({...o,photoCount:h,videoCount:y,cover:r})}),b("Camera",{action:"getAlbums"}).then(l=>{if(!l)return v("error","No data received from server");let h=z.map(y=>{const D=l.mediaTypes[y.id+"Photos"]??0,x=l.mediaTypes[y.id+"Videos"]??0;return{...y,count:D+x,photoCount:D,videoCount:x}});f.APPS.CAMERA.albums.set(l.albums),f.APPS.CAMERA.mediaTypes.set(h)})})})}}]})}},E&&{title:i("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),cb:()=>{let r="";L.PopUp.set({title:i("APPS.PHOTOS.RENAME_ALBUM_POPUP.TITLE"),description:i("APPS.PHOTOS.RENAME_ALBUM_POPUP.DESCRIPTION"),input:{placeholder:i("APPS.PHOTOS.RENAME_ALBUM_POPUP.PLACEHOLDER"),minCharacters:1,maxCharacters:20,onChange:P=>{r=P}},buttons:[{title:i("APPS.PHOTOS.RENAME_ALBUM_POPUP.CANCEL")},{title:i("APPS.PHOTOS.RENAME_ALBUM_POPUP.PROCEED"),cb:()=>{if(r.length<1)return v("warning","Input is empty, cannot rename album");v("info","Renaming album",o.id,r),b("Camera",{action:"renameAlbum",id:o.id,title:r},!0).then(P=>{if(!P)return v("error","Could not rename album, server returned false");H.set({...o,title:r}),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(N=>N.id===o.id?{...N,title:r}:N))})}}]})}},E&&{title:i("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{L.PopUp.set({title:i("APPS.PHOTOS.REMOVE_ALBUM.TITLE",{name:o.title}),description:i("APPS.PHOTOS.REMOVE_ALBUM.DESCRIPTION",{name:o.title}),buttons:[{title:i("APPS.PHOTOS.REMOVE_ALBUM.CANCEL")},{title:i("APPS.PHOTOS.REMOVE_ALBUM.PROCEED"),color:"red",cb:()=>{b("Camera",{action:"deleteAlbum",id:o.id},!0).then(r=>{if(!r)return v("error","Could not remove album, server returned false");f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.filter(P=>P.id!==o.id)),H.set(null)})}}]})}}]})},children:t(Ee,{})})]})]}),t("div",{className:"name",style:{color:p.length<15?"var(--phone-text-primary)":"#ffffff"},children:o.title})]}),C("div",{className:"library-content","data-offset":p.length<15,onScroll:u,"data-no-photos":M,children:[M&&C("div",{className:"no-photos",children:[t("div",{className:"title",children:i("APPS.PHOTOS.NO_PHOTOS")}),t("div",{className:"description",children:i("APPS.PHOTOS.NO_PHOTOS_INSTRUCTIONS")})]}),!c&&o.photoCount!==void 0&&!M&&t(ee,{children:C("div",{className:"info",children:[i("APPS.PHOTOS.PHOTO_COUNT",{amount:o.photoCount.toString()}),", ",i("APPS.PHOTOS.VIDEO_COUNT",{amount:o.videoCount.toString()})]})}),t("div",{className:"library-grid",children:p.map((E,e)=>C("div",{id:e===0?"last":"",className:"grid-item",onClick:()=>{if(c){const a=s.find(r=>r.id===E.id);S(a?s.filter(r=>r.id!==E.id):[...s,E])}else V.set({activeImage:E,images:p})},children:[E.isVideo?t($,{src:E.src,showAdvanced:!c}):t("div",{className:"img",style:{backgroundImage:`url(${E.src})`}}),t("div",{className:"checkbox",children:c&&(s.find(a=>a.id===E.id)?t(W,{checked:!0}):t(W,{checked:!1}))})]},e))})]}),c&&C("div",{className:"select-footer",children:[t("div",{className:"icons","data-disabled":s.length===0,children:t(te,{})}),t("div",{className:"title",children:s.length===0?i("APPS.PHOTOS.SELECT_ITEMS"):i("APPS.PHOTOS.SELECTED_COUNT",{count:s.length})}),C("div",{className:"icons","data-disabled":s.length===0,children:[t(oe,{onClick:()=>{if(s.length===0)return;let E=o.id!=="recents"&&o.id!=="favourites"&&o.id!=="phone";L.ContextMenu.set({title:E&&i("APPS.PHOTOS.DELETE_CONTEXT_TITLE",{type:s.length>1?i("APPS.PHOTOS.THESE_PHOTOS"):i("APPS.PHOTOS.THIS_PHOTO")}),buttons:[E&&{title:i("APPS.PHOTOS.REMOVE_FROM_ALBUM"),cb:()=>{b("Camera",{action:"removeFromAlbum",album:o.id,ids:s.map(e=>e.id)}).then(e=>{if(!e)return v("error","Could not remove from album, server returned false");let n=o.photoCount-s.filter(r=>!r.isVideo).length,a=o.videoCount-s.filter(r=>r.isVideo).length;f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(r=>{if(r.id===o.id)return{...r,count:r.count-s.length,photoCount:n,videoCount:a}})),H.set({...o,photoCount:n,videoCount:a}),I(p.filter(r=>!s.find(P=>r.id===P.id))),S([]),U.set(!1)})}},{title:i("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{b("Camera",{action:"deleteFromGallery",ids:s.map(e=>e.id)},!0,o.id==="phone").then(e=>{if(!e)return v("error","Could not delete from gallery, server returned false");let n=0;s.forEach(P=>{n+=P.size}),window.postMessage({action:"phone:updateStorage",add:!1,size:n});let a=o.photoCount-s.filter(P=>!P.isVideo).length,r=o.videoCount-s.filter(P=>P.isVideo).length;b("Camera",{action:"getAlbums"}).then(P=>{if(!P)return v("error","No data received from server");let N=z.map(d=>{const l=P.mediaTypes.find(h=>h.id===d.id);return l?{...d,count:l.count}:d});f.APPS.CAMERA.albums.set(P.albums),f.APPS.CAMERA.mediaTypes.set(N)}),H.set({...o,photoCount:a,videoCount:r}),I(p.filter(P=>!s.find(N=>P.id===N.id))),S([]),U.set(!1)})}}]})}}),t(ae,{onClick:()=>{if(s.length===0)return;let E=s.find(e=>!e.favourite);L.ContextMenu.set({buttons:[o.id!=="phone"&&{title:i("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{G.set({images:s,onSelect:e=>{b("Camera",{action:"addToAlbum",album:e.id,ids:s.map(n=>n.id)},!0).then(n=>{if(!n)return v("error","Could not add to album, server returned false");S([]),U.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(a=>a.id===e.id?{...a,count:a.count+s.length,photoCount:a.photoCount+s.filter(r=>!r.isVideo).length,videoCount:a.videoCount+s.filter(r=>r.isVideo).length,cover:s[s.length-1].src}:a))})}})}},o.id!=="phone"&&{title:E?i("APPS.PHOTOS.ADD_TO_FAVOURITES"):i("APPS.PHOTOS.REMOVE_FROM_FAVOURITES"),cb:()=>{b("Camera",{action:"toggleFavourites",ids:s.map(e=>e.id),favourite:!!E},!0).then(e=>{if(!e)return v("error","Could not add to favourites, server returned false");S([]),U.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(n=>n.id==="favourites"?{...n,count:n.count+s.length,photoCount:n.photoCount+s.filter(a=>!a.isVideo).length,videoCount:n.videoCount+s.filter(a=>a.isVideo).length,cover:s[s.length-1].src}:n))})}},o.id==="phone"&&{title:"Add to Tablet",cb:()=>{b("Camera",{action:"importFromPhone",ids:s.map(e=>e.id)},!0).then(e=>{if(!e)return v("error","Could not add to tablet, server returned false");S([]),U.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(n=>n.id==="recents"?{...n,count:n.count+s.length,photoCount:n.photoCount+s.filter(a=>!a.isVideo).length,videoCount:n.videoCount+s.filter(a=>a.isVideo).length,cover:s[s.length-1].src}:n))})}}]})}})]})]})]})};i("APPS.PHOTOS.YEARS"),i("APPS.PHOTOS.MONTHS"),i("APPS.PHOTOS.DAYS"),i("APPS.PHOTOS.ALL_PHOTOS");function Le(){const o=R(U),[c,s]=g.useState([]),[S,p]=g.useState([]),[I,M]=g.useState(!1);g.useState("all");const[A,w]=g.useState(null),[m,B]=g.useState(!1),[k,u]=g.useState(!1);g.useState(0);const O=()=>{var D,x;let e=[],n=document.querySelectorAll(".grid-item");if(n.length===0||(n.forEach(Y=>{!Q(Y)&&e.push(Y)}),e.length===0))return w(null);let a=e[0],r=parseInt(a==null?void 0:a.getAttribute("data-id"));if(!r)return;let P=(D=S.find(Y=>Y.id===r))==null?void 0:D.timestamp,N=e[e.length-1],d=parseInt(N.getAttribute("data-id")),l;if(d&&(l=(x=S.find(Y=>Y.id===d))==null?void 0:x.timestamp),!P)return;let h=T(P),y=T(l);if(h===y||!l)return w(h);w(`${h} - ${y}`)},T=e=>{let n=new Date(e),a=n.toLocaleString("default",{month:"short"}),r=n.getDate(),P=n.getFullYear();return`${r} ${a} ${P}`};g.useEffect(()=>{K("Photos")&&b("Camera",{action:"getImages"},_.Photos.sort((e,n)=>n.timestamp-e.timestamp).reverse()).then(e=>{if(!e)return v("warning","No data was returned from getImages event");p(e.reverse()),M(e.length===0)})},[]);const E=e=>{var r;if(O(),m||k)return;let n=document.querySelector("#last");if(!n)return;if(!Q(n)){const P=document.querySelector(".library-content");P||v("warning","Could not find library content element");const N=P==null?void 0:P.scrollHeight;u(!0),b("Camera",{action:"getImages",lastId:(r=S[0])==null?void 0:r.id},null).then(d=>{d&&d.length>0?(P.style.transform=`translateY(${N}px)`,p([...d.reverse(),...S]),u(!1),requestAnimationFrame(()=>{P.style.transition="transform 0ms",P.style.transform="translateY(0)"}),d.length<30&&B(!0)):B(!0)})}};return C(F.div,{...ne("left","library"),className:"library-wrapper",children:[t("div",{className:"library-header",children:C("div",{className:"top",children:[t("div",{className:"info",children:t("div",{className:"date",style:{color:S.length<15?"var(--phone-text-primary)":"#ffffff"},children:A&&A})}),t("div",{className:"actions",children:t("div",{className:"button",onClick:()=>U.set(!o),children:o?i("APPS.PHOTOS.DONE"):i("APPS.PHOTOS.SELECT")})})]})}),t("div",{className:"library-content","data-offset":S.length<15,onScroll:E,children:t("div",{className:"library-grid","data-zoomlevel":"5",children:S.map((e,n)=>C("div",{id:n===0?"last":"",className:"grid-item","data-id":e.id,onClick:()=>{if(o){const r=c.find(P=>P.id===e.id);s(r?c.filter(P=>P.id!==e.id):[...c,e])}else V.set({activeImage:e,images:S})},children:[e.isVideo?t($,{src:e.src,showAdvanced:!o}):t("div",{className:"img",style:{backgroundImage:`url(${e.src})`}}),t("div",{className:"checkbox",children:o&&(c.find(r=>r.id===e.id)?t(W,{checked:!0}):t(W,{checked:!1}))})]}))})}),o&&C("div",{className:"select-footer",children:[t("div",{className:"icons","data-disabled":c.length===0,children:t(te,{})}),t("div",{className:"title",children:c.length===0?i("APPS.PHOTOS.SELECT_ITEMS"):i("APPS.PHOTOS.SELECTED_COUNT",{count:c.length})}),C("div",{className:"icons","data-disabled":c.length===0,children:[t(oe,{onClick:()=>{c.length!==0&&L.ContextMenu.set({buttons:[{title:i("APPS.PHOTOS.DELETE"),color:"red",cb:()=>{b("Camera",{action:"deleteFromGallery",ids:c.map(e=>e.id)},!0).then(()=>{p(S.filter(n=>!c.find(a=>n.src===a.src))),s([]);let e=0;c.forEach(n=>{e+=n.size}),window.postMessage({action:"phone:updateStorage",add:!1,size:e}),b("Camera",{action:"getAlbums"}).then(n=>{if(!n)return v("error","No data received from server");let a=z.map(r=>{const P=n.mediaTypes[r.id+"Photos"]??0,N=n.mediaTypes[r.id+"Videos"]??0;return{...r,count:P+N,photoCount:P,videoCount:N}});f.APPS.CAMERA.albums.set(n.albums),f.APPS.CAMERA.mediaTypes.set(a)})})}}]})}}),t(be,{onClick:()=>{c.length!==0&&L.ContextMenu.set({buttons:[{title:i("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{G.set({images:c,onSelect:e=>{b("Camera",{action:"addToAlbum",album:e.id,ids:c.map(n=>n.id)},!0).then(n=>{if(!n)return v("error","Could not add to album, server returned false");s([]),U.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(a=>a.id===e.id?{...a,count:a.count+c.length,photoCount:a.photoCount+c.filter(r=>!r.isVideo).length,videoCount:a.videoCount+c.filter(r=>r.isVideo).length,cover:c[c.length-1].src}:a))})}})}},{title:i("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{b("Camera",{action:"toggleFavourites",ids:c.map(e=>e.id),favourite:!0},!0).then(e=>{if(!e)return v("error","Could not add to favourites, server returned false");s([]),U.set(!1),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(n=>n.id==="favourites"?{...n,count:n.count+c.length,photoCount:n.photoCount+c.filter(a=>!a.isVideo).length,videoCount:n.videoCount+c.filter(a=>a.isVideo).length,cover:c[c.length-1].src}:n))})}}]})}})]})]})]})}function He(){var S,p,I;const o=R(G),c=R(f.APPS.CAMERA.albums);let s=(S=o==null?void 0:o.images)==null?void 0:S[(o==null?void 0:o.images.length)-1];return C(F.div,{initial:{opacity:0,scale:.9,y:250},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:250},className:"addtoalbum-container",children:[C("div",{className:"addtoalbum-header",children:[t("div",{}),t("div",{className:"title",children:i("APPS.PHOTOS.ADD_TO_ALBUM")}),t("div",{className:"cancel",onClick:()=>G.reset(),children:i("APPS.PHOTOS.CANCEL")})]}),C("div",{className:"addtoalbum-content",children:[C("div",{className:"preview",children:[j(s==null?void 0:s.src)?t($,{src:s==null?void 0:s.src,showAdvanced:!1}):t("img",{src:s==null?void 0:s.src}),t("div",{className:"title",children:i("APPS.PHOTOS.SELECTED_COUNT",{count:(p=o==null?void 0:o.images)==null?void 0:p.length})})]}),t("div",{className:"albums",children:(I=c==null?void 0:c.filter(M=>M.id!=="favourites"&&M.id!=="recents"))==null?void 0:I.map((M,A)=>C("div",{className:"album",onClick:()=>{o.onSelect(M),G.reset()},children:[t("div",{className:"cover",children:j(M.cover)?t($,{src:M.cover,showAdvanced:!1}):t("img",{src:M.cover??"https://join.travelmanagers.com.au/wp-content/uploads/2017/09/default-placeholder-300x300.png"})}),t("div",{className:"title",children:M.title}),t("div",{className:"count",children:M.count})]},A))})]})]})}function _e(){const o=R(Z),[c,s]=g.useState([{icon:t(Me,{}),title:i("APPS.PHOTOS.LIBRARY"),value:"library"},{icon:t(Ie,{}),title:i("APPS.PHOTOS.ALBUMS"),value:"albums"}]);return t("div",{className:"photos-footer",children:c.map((S,p)=>C("div",{className:"item","data-active":o===S.value,onClick:()=>{Z.set(S.value),S.value==="albums"&&o==="albums"&&(H!=null&&H.value)&&H.reset()},children:[S.icon,S.title]},p))})}const ie=g.forwardRef((o,c)=>{const s=R(ce),[S,p]=g.useState(!0),[I,M]=g.useState(!0);return g.useEffect(()=>{le(o.src,A=>{M(A),A||p(!1)})},[]),t("img",{...o,ref:c,src:I?o.src:"https://www.slntechnologies.com/wp-content/uploads/2017/08/ef3-placeholder-image.jpg","data-isblurred":s.streamerMode&&!o.ignoreStreamerMode&&S,onClick:A=>{if(s.streamerMode&&!o.ignoreStreamerMode&&S){A.preventDefault(),A.stopPropagation(),p(!1);return}o!=null&&o.onClick&&o.onClick()}})}),Ue=()=>{var r,P,N;const o=R(J),c=R(ce),[s,S]=g.useState(!0),p=g.useRef(!1),[I,M]=g.useState(0),A=g.useRef(null),w=g.useRef(null),m=R(V),[B,k]=g.useState(new Date(((P=(r=V==null?void 0:V.value)==null?void 0:r.activeImage)==null?void 0:P.timestamp)??0)),[u,O]=g.useState(((N=m==null?void 0:m.activeImage)==null?void 0:N.favourite)??!1),[T,E]=g.useState([]);let e=(m==null?void 0:m.images)??[];g.useEffect(()=>{if(!(m!=null&&m.activeImage))return v("warning","No active image when changing volume");if(m.activeImage.isVideo){const d=document.getElementById(m.activeImage.id);if(!d)return;d.volume=c.sound.volume}},[c.sound.volume]),g.useEffect(()=>{var l;if(!m)return;let d=e.findIndex(h=>h.id===m.activeImage.id);if(M(d),O(m.activeImage.favourite),m.activeImage.isVideo){const h=document.getElementById(m.activeImage.id);if(!h)return v("warning","Video Element not found (Carousel effect)");h.play(),h.volume=c.sound.volume}if(e.length>0){let h=[];d===0?h=e.slice(0,12):d===e.length-1?h=e.slice(e.length-12,e.length):d<6?h=e.slice(0,12):d>e.length-6?h=e.slice(e.length-12,e.length):h=e.slice(d-6,d+6),k(new Date((l=e==null?void 0:e[d])==null?void 0:l.timestamp)),E(h)}},[m==null?void 0:m.activeImage]);const n={pos:{startLeft:0,startX:0},onMouseDown:d=>{n.pos={startLeft:A.current.scrollLeft,startX:d.clientX},A.current.style.userSelect="none",document.addEventListener("mouseup",n.onMouseUp),document.addEventListener("mousemove",n.onMove)},onMove:d=>{if(!A.current)return;const l=d.clientX-n.pos.startX;A.current.scrollLeft=n.pos.startLeft-l;const h=A.current.getBoundingClientRect();(h.left-5>d.clientX||d.clientX>h.right-5)&&n.onMouseUp(),p.current=!0},onMouseUp:()=>{if(!A.current)return;A.current.style.removeProperty("user-select"),document.removeEventListener("mouseup",n.onMouseUp),document.removeEventListener("mousemove",n.onMove);const d=A.current.clientWidth;let l=I;const h=A.current.scrollLeft-n.pos.startLeft;if(h>d/2&&l<e.length?l++:h<-d/2&&l>0&&l--,m.activeImage.id!==e[l].id&&m.activeImage.isVideo){const D=document.getElementById(m.activeImage.id);D&&(D.pause(),D.currentTime=0)}V.set({activeImage:e[l],images:e}),document.getElementById(e[l].id).scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{p.current=!1},100)}},a=d=>{m.activeImage.isVideo&&document.getElementById(m.activeImage.id).pause(),V.set({activeImage:d,images:e}),document.getElementById(d.id).scrollIntoView({behavior:"smooth",block:"center"})};return C(F.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.25},className:"activephoto-container",children:[t(X,{children:s&&C(F.div,{className:"photo-top",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[t("div",{className:"back",onClick:()=>{L.Share.reset(),V.reset()},children:t(re,{})}),C("div",{className:"date",children:[B.toLocaleString([],{day:"2-digit",month:"long"}),t("span",{children:B.toLocaleTimeString(o.DateLocale,{hour:"numeric",minute:"numeric",hour12:c.time.twelveHourClock})})]}),t("div",{children:t(ae,{onClick:()=>{L.ContextMenu.set({buttons:[{title:i("APPS.PHOTOS.ADD_TO_ALBUM"),cb:()=>{G.set({images:[m.activeImage],onSelect:d=>{b("Camera",{action:"addToAlbum",album:d.id,ids:[m.activeImage.id]},!0).then(l=>{if(!l)return v("error","Could not add to album, server returned false");f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(h=>h.id===d.id?{...h,count:h.count+1,photoCount:m.activeImage.isVideo?h.photoCount:h.photoCount+1,videoCount:m.activeImage.isVideo?h.videoCount+1:h.videoCount,cover:m.activeImage.src}:h))})}})}},{title:u?i("APPS.PHOTOS.REMOVE_FROM_FAVOURITES"):i("APPS.PHOTOS.ADD_TO_FAVOURITES"),cb:()=>{b("Camera",{action:"toggleFavourites",ids:[m.activeImage.id],favourite:!u}).then(d=>{if(!d)return v("error","Could not add to favourites, server returned false");f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(l=>l.id==="favourites"?{...l,count:l.count+1,photoCount:m.activeImage.isVideo?l.photoCount:l.photoCount+1,videoCount:m.activeImage.isVideo?l.videoCount+1:l.videoCount,cover:m.activeImage.src}:l))})}}]})}})})]})}),t("div",{className:"image-overflow",ref:A,onMouseDown:n.onMouseDown,style:{backgroundColor:s?"var(--tablet-color-primary)":"rgba(0, 0, 0)"},onClick:()=>{p.current||S(!s)},children:e==null?void 0:e.map((d,l)=>{const h=d.id===m.activeImage.id;return d.isVideo?t("video",{id:d.id,src:d.src,className:h?"active":null,crossOrigin:"anonymous",loop:!0,onLoadedMetadata:y=>{h&&(y.target.scrollIntoView({block:"center"}),y.target.play())}},l):t(ie,{id:d.id,src:d.src,className:h?"active":null,ignoreStreamerMode:!0,onLoad:y=>{h&&y.target.scrollIntoView({block:"center"})}},l)})}),t(X,{children:s&&C(F.div,{className:"photo-bottom-wrapper",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:[t("div",{className:"photo-carousel",ref:w,children:T.map((d,l)=>d.isVideo?t("video",{src:d.src,"data-carousel":l,controls:!1,muted:!0,onClick:h=>a(d)},l):t(ie,{src:d.src,"data-carousel":l,onClick:h=>a(d)},l))}),C("div",{className:"photo-bottom",children:[t(te,{onClick:()=>{L.Share.set({type:"image",data:{src:m.activeImage.src,isVideo:m.activeImage.isVideo}})}}),t("div",{onClick:()=>{b("Camera",{action:"toggleFavourites",ids:[m.activeImage.id],favourite:!u},!0).then(d=>{if(!d)return v("warning","Failed to toggle favourite, server returned success false");O(!u),f.APPS.CAMERA.albums.set(f.APPS.CAMERA.albums.value.map(l=>l.id==="favourites"?{...l,count:u?l.count-1:l.count+1,photoCount:m.activeImage.isVideo?l.photoCount:u?l.photoCount-1:l.photoCount+1,videoCount:m.activeImage.isVideo?u?l.videoCount-1:l.videoCount+1:l.videoCount,cover:m.activeImage.src}:l))})},children:u?t(se,{}):t(Ne,{})}),t(oe,{onClick:()=>{L.PopUp.set({title:i("APPS.PHOTOS.DELETE_IMAGE_POPUP.TITLE"),description:i("APPS.PHOTOS.DELETE_IMAGE_POPUP.DESCRIPTION"),buttons:[{title:i("APPS.PHOTOS.DELETE_IMAGE_POPUP.CANCEL")},{title:i("APPS.PHOTOS.DELETE_IMAGE_POPUP.PROCEED"),color:"red",cb:()=>{b("Camera",{action:"deleteFromGallery",ids:[m.activeImage.id]},!0).then(d=>{if(!d)return v("error","Could not delete from gallery, server returned false");V.reset(),b("Camera",{action:"getAlbums"}).then(l=>{if(!l)return v("error","No data received from server");let h=z.map(y=>{const D=l.mediaTypes[y.id+"Photos"]??0,x=l.mediaTypes[y.id+"Videos"]??0;return{...y,count:D+x,photoCount:D,videoCount:x}});f.APPS.CAMERA.albums.set(l.albums),f.APPS.CAMERA.mediaTypes.set(h)})})}}]})}})]})]})})]})},Z=q("albums"),U=q(!1),V=q(null),G=q(null),De={library:t(Le,{}),albums:t(ye,{})},Be=[2,3,4,5];function ke(){const o=R(Z),c=R(V),s=R(U),S=R(G);return C("div",{className:"photos-container",children:[t("div",{className:"photos-content",style:{pointerEvents:c?"none":"all"},children:De[o]}),!s&&t(_e,{}),t(X,{children:c&&t(Ue,{})}),t(X,{children:S&&t(He,{})})]})}export{V as ActiveImage,G as AlbumPickerComponent,U as SelectMode,Z as View,ke as default,Be as zoomLevels};
