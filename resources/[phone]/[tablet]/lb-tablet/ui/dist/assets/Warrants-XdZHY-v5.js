import{u as O,r as A,h as C,bF as U,G as v,k as x,j as t,m as I,ac as ie,a as c,L as i,o as F,H as le,bf as ae,bh as K,bO as re,K as se,a5 as ce,$ as Y,F as de,W as ne,I as oe,a2 as Pe,f as M,bi as V,bS as ue,bT as Ae,g,R as he,bP as Re,bG as Ee,bH as Ne,bK as te}from"./index-B-vcvQz_.js";const R=se([]),l=se(null),m={low:{color:"green",label:i("APPS.POLICE.WARRANTS.LOW_PRIORITY")},medium:{color:"orange",label:i("APPS.POLICE.WARRANTS.MEDIUM_PRIORITY")},high:{color:"red",label:i("APPS.POLICE.WARRANTS.HIGH_PRIORITY")}},p={active:{color:"green",label:i("APPS.POLICE.WARRANTS.ACTIVE")},expired:{color:"red",label:i("APPS.POLICE.WARRANTS.EXPIRED")},cancelled:{color:"orange",label:i("APPS.POLICE.WARRANTS.CANCELLED")}};function pe(){var b;const e=O(R),N=O(l),E=O(Y.APPS.POLICE.permissions),[n,y]=A.useState(""),[T,H]=A.useState(""),[G,L]=A.useState(0),[W,S]=A.useState(!1),[D,f]=A.useState(!1);A.useEffect(()=>{const r=setTimeout(()=>y(T),500);return()=>clearTimeout(r)},[T]),A.useEffect(()=>{L(0),S(!1),C("Police",{action:"getWarrants",search:n},U.warrants.filter(r=>r.title.toLowerCase().includes(n.toLowerCase()))).then(r=>{if(!r)return v("error","Failed to fetch warrants");R.set(r)})},[n]);const k=()=>{if(W||D)return;let r=document.querySelector("#last");if(!r)return;!ce(r)&&(f(!0),C("Police",{action:"getWarrants",query:n,page:G+1},null).then(P=>{P&&P.length>0?(R.set([...e,...P]),f(!1),P.length<10&&S(!0)):S(!0)}),L(P=>P+1))},_=r=>{if(!r)return v("error","Invalid ID");C("Police",{action:"getWarrant",id:r},U.warrants.find(o=>o.id===r)).then(o=>{if(!o)return v("error","Failed to fetch warrant");l.set(o)})};return x("police:warrantDeleted",r=>{var o;if(!r)return v("error","No id provided in warrantDeleted event");R.set(R.value.filter(P=>P.id!==r)),((o=l.value)==null?void 0:o.id)===r&&l.reset()}),t(I.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:N?t(ie,{children:t(ve,{})}):t("main",{className:"main profiles",children:c("div",{className:"page",children:[c("div",{className:"top",children:[t("div",{className:"title",children:i("APPS.POLICE.WARRANTS.TITLE")}),((b=E==null?void 0:E.warrant)==null?void 0:b.create)&&c("div",{className:"button",onClick:()=>l.set({}),children:[t(F,{}),i("APPS.POLICE.NEW")]})]}),t(le,{placeholder:i("APPS.POLICE.WARRANTS.SEARCH"),onChange:r=>H(r.target.value)}),t("div",{className:"items",onScroll:k,children:e.map((r,o)=>{let P=o===e.length-1?"last":"";return t(I.div,{...ae,id:P,className:"item",onClick:()=>_(r.id),children:c("div",{className:"info",children:[t("div",{className:"name",children:r.title}),t("div",{className:"subtitle",children:r.description.substring(0,150)}),c("div",{className:"cards",children:[t("div",{className:K("card",p[r.status].color),children:p[r.status].label}),t("div",{className:"divider"}),t("div",{className:K("card",m[r.priority].color),children:m[r.priority].label})]}),c("div",{className:"id report",children:[t("div",{className:"label",children:i("APPS.POLICE.WARRANTS.FOOTER",{author:r.author,id:r.id})}),t("div",{className:"value",children:re(r.lastUpdated)})]})]})},o)})})]})})})}const ve=()=>{var W,S,D,f,k,_,b,r,o,P,j,B,q,z,X,$,J,Q;const e=O(l),N=O(M),E=O(Y.APPS.POLICE.permissions),[n,y]=A.useState(!(e!=null&&e.id)),T=A.useRef(!1);A.useEffect(()=>{var s,a,d,u;(s=l.value)!=null&&s.id||l.set({title:i("APPS.POLICE.WARRANTS.TITLE_PLACEHOLDER"),description:(a=N==null?void 0:N.Police)==null?void 0:a.Templates.Warrant,type:(u=(d=N==null?void 0:N.Police)==null?void 0:d.WarrantTypes)==null?void 0:u[0],status:"active",priority:"low"})},[]);const H=()=>{var s,a,d,u;if(!(e!=null&&e.title)||((s=e==null?void 0:e.title)==null?void 0:s.length)<3)return g.PopUp.set({title:i("APPS.POLICE.WARRANTS.ERROR.TITLE"),description:i("APPS.POLICE.WARRANTS.ERROR.TITLE_LENGTH"),buttons:[{title:i("APPS.POLICE.WARRANTS.ERROR.OK")}]});if(!(e!=null&&e.type))return g.PopUp.set({title:i("APPS.POLICE.WARRANTS.ERROR.TITLE"),description:i("APPS.POLICE.WARRANTS.ERROR.NO_TYPE"),buttons:[{title:i("APPS.POLICE.WARRANTS.ERROR.OK")}]});if(!(e!=null&&e.description)||((a=e==null?void 0:e.description)==null?void 0:a.length)<10)return g.PopUp.set({title:i("APPS.POLICE.WARRANTS.ERROR.TITLE"),description:i("APPS.POLICE.WARRANTS.ERROR.DESCRIPTION_LENGTH"),buttons:[{title:i("APPS.POLICE.WARRANTS.ERROR.OK")}]});if(!T.current){v("info","No edits made, skipping save"),l.reset();return}C("Police",{action:"saveWarrant",data:{...e,tags:(d=e.tags)==null?void 0:d.map(h=>h.id),reports:(u=e.reports)==null?void 0:u.map(h=>h.id)}}).then(h=>{var Z;if(!h)return v("error","Failed to save warrant");e.id?R.set(R.value.map(w=>{var ee;return w.id===h?{...e,lastUpdated:Date.now(),author:(ee=te.value)==null?void 0:ee.name}:w})):R.set([{...e,id:h,lastUpdated:Date.now(),author:(Z=te.value)==null?void 0:Z.name},...R.value]),l.reset()})},G=()=>{C("Police",{action:"deleteWarrant",id:e.id}).then(s=>{if(!s)return v("error","Failed to delete warrant");R.set(R.value.filter(a=>a.id!==e.id)),l.reset()})};let L=A.useRef(!0);return A.useEffect(()=>{if(e){if(L.current){L.current=!1;return}T.current=!0}},[e]),x("police:tagAdded",s=>{const{type:a,id:d,tagId:u}=s;a==="warrant"&&d===e.id&&l.set({...l.value,tags:[...e.tags??[],Y.APPS.POLICE.tags.value.find(h=>h.id===u)]})}),x("police:tagRemoved",s=>{const{type:a,id:d,tagId:u}=s;a==="warrant"&&d===e.id&&l.set({...l.value,tags:[...e.tags.filter(h=>h.id!==u)]})}),t(I.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{ease:"easeInOut",duration:.25},className:"grid-container",children:e&&c(de,{children:[c("div",{className:"grid-header",children:[c("div",{className:"back",onClick:()=>l.reset(),children:[t(ne,{})," ",i("APPS.POLICE.BACK")]}),t("div",{className:"title",children:t(oe,{type:"text",defaultValue:(e==null?void 0:e.title)??i("APPS.POLICE.WARRANTS.TITLE_PLACEHOLDER"),disabled:!n,style:{width:((e==null?void 0:e.title)??i("APPS.POLICE.WARRANTS.TITLE_PLACEHOLDER")).length+2+"ch"},onChange:s=>{s.target.value.length<25&&(s.target.style.width=s.target.value.length+2+"ch"),l.set({...l.value,title:s.target.value})}})}),c("div",{className:"buttons",children:[((W=E==null?void 0:E.warrant)==null?void 0:W.delete)&&!n&&e.id&&t("div",{className:"button red",onClick:G,children:i("APPS.POLICE.DELETE")}),n&&t("div",{className:"button red",onClick:()=>{e.id?y(!1):l.reset()},children:i("APPS.POLICE.CANCEL")}),((S=E==null?void 0:E.warrant)==null?void 0:S.edit)&&t("div",{className:"button",onClick:()=>{n?H():y(!0)},children:n?i("APPS.POLICE.SAVE"):i("APPS.POLICE.EDIT")})]})]}),c("div",{className:"grid-body",style:{gridTemplateAreas:`
                                'type status'
                                'description priority'
                                'description tags'
                                'description reports'
                                '. gallery'
                            `,overflowY:"auto",paddingBottom:"2rem"},children:[c("div",{className:"grid-item",style:{gridArea:"description"},children:[t("div",{className:"top",children:t("div",{className:"title",children:i("APPS.POLICE.WARRANTS.DESCRIPTION")})}),t("div",{className:"items",children:t(Pe,{className:"note",placeholder:i("APPS.POLICE.WARRANTS.DESCRIPTION_PLACEHOLDER"),defaultValue:e.description??((_=(k=(f=(D=M)==null?void 0:D.value)==null?void 0:f.Police)==null?void 0:k.Templates)==null?void 0:_.Warrant),disabled:!n,onChange:s=>l.set({...l.value,description:s.target.value}),style:{height:"20rem"}})})]}),c("div",{className:"grid-item",style:{gridArea:"type"},children:[t("div",{className:"top",children:t("div",{className:"title",children:i("APPS.POLICE.WARRANTS.TYPE")})}),t("div",{className:"items",children:t("select",{disabled:!n,value:e.type,onChange:s=>l.set({...l.value,type:s.target.value}),children:(P=(o=(r=(b=M)==null?void 0:b.value)==null?void 0:r.Police)==null?void 0:o.WarrantTypes)==null?void 0:P.map((s,a)=>t("option",{selected:e.type===s,children:s},a))})})]}),c("div",{className:"grid-item",style:{gridArea:"status"},children:[t("div",{className:"top",children:t("div",{className:"title",children:i("APPS.POLICE.WARRANTS.STATUS")})}),t("div",{className:"items",children:t("select",{disabled:!n,value:(j=p[e==null?void 0:e.status])==null?void 0:j.label,onChange:s=>{const a=Object.keys(p).find(d=>p[d].label===s.target.value);l.set({...l.value,status:a})},children:Object.keys(p).map((s,a)=>{var d;return t("option",{selected:(e==null?void 0:e.status)===s,children:(d=p[s])==null?void 0:d.label},a)})})})]}),c("div",{className:"grid-item",style:{gridArea:"priority"},children:[t("div",{className:"top",children:t("div",{className:"title",children:i("APPS.POLICE.WARRANTS.PRIORITY")})}),t("div",{className:"items",children:t("select",{disabled:!n,value:(B=m[e==null?void 0:e.priority])==null?void 0:B.label,onChange:s=>{const a=Object.keys(m).find(d=>m[d].label===s.target.value);l.set({...l.value,priority:a})},children:Object.keys(m).map((s,a)=>{var d;return t("option",{selected:(e==null?void 0:e.priority)===s,children:(d=m[s])==null?void 0:d.label},a)})})})]}),c("div",{className:"grid-item",style:{gridArea:"tags"},children:[c("div",{className:"top",children:[t("div",{className:"title",children:i("APPS.POLICE.TAGS.TITLE")}),n&&c(I.div,{...V,className:"button",onClick:()=>{ue("warrant",e==null?void 0:e.id,!1,s=>l.set({...l.value,tags:[...e.tags??[],s]}))},children:[t(F,{}),i("APPS.POLICE.TAGS.ADD")]})]}),c("div",{className:"items",children:[(!(e!=null&&e.tags)||((q=e==null?void 0:e.tags)==null?void 0:q.length)===0)&&t("div",{className:"no-results",children:i("APPS.POLICE.TAGS.NO_TAGS")}),t("div",{className:"cards",children:(z=e==null?void 0:e.tags)==null?void 0:z.map((s,a)=>t(Ae,{tag:s,editMode:n,cb:()=>{l.set({...l==null?void 0:l.value,tags:e.tags.filter(d=>d.id!==s.id)})}},a))})]})]}),c("div",{className:"grid-item",style:{gridArea:"gallery"},children:[c("div",{className:"top",children:[t("div",{className:"title",children:i("APPS.POLICE.WARRANTS.GALLERY")}),n&&c(I.div,{...V,className:"button",onClick:()=>{g.Gallery.set({onSelect:s=>{l.set({...l.value,gallery:[...e.gallery??[],s.src]})}})},children:[t(F,{}),i("APPS.POLICE.ADD")]})]}),c("div",{className:"items",children:[(!(e!=null&&e.gallery)||((X=e==null?void 0:e.gallery)==null?void 0:X.length)===0)&&t("div",{className:"no-results",children:i("APPS.POLICE.WARRANTS.NO_ATTACHMENTS")}),t("div",{className:"images",children:($=e==null?void 0:e.gallery)==null?void 0:$.map((s,a)=>c("div",{className:"image",children:[t("img",{src:s,onClick:()=>g.FullscreenImage.set(s)}),n&&t(he,{onClick:()=>{l.set({...l.value,gallery:e.gallery.filter((d,u)=>u!==a)})}})]},a))})]})]}),c("div",{className:"grid-item",style:{gridArea:"reports"},children:[c("div",{className:"top",children:[t("div",{className:"title",children:i("APPS.POLICE.WARRANTS.LINKED_REPORTS")}),n&&c(I.div,{...V,className:"button",onClick:()=>{var s;Re.set({type:"reports",exclude:(s=e==null?void 0:e.reports)==null?void 0:s.map(a=>a.id),onSelect:a=>{l.set({...l.value,reports:[...e.reports??[],{id:a.id,label:a.title}]})}})},children:[t(F,{}),i("APPS.POLICE.ADD")]})]}),c("div",{className:"items",children:[(!(e!=null&&e.reports)||((J=e==null?void 0:e.reports)==null?void 0:J.length)===0)&&t("div",{className:"no-results",children:i("APPS.POLICE.WARRANTS.NO_LINKED_REPORTS")}),t("div",{className:"cards",children:(Q=e==null?void 0:e.reports)==null?void 0:Q.map((s,a)=>c("div",{className:K("card blue","clickable"),onClick:()=>{n?g.PopUp.set({title:i("APPS.POLICE.WARRANTS.REMOVE_REPORT.TITLE"),description:i("APPS.POLICE.WARRANTS.REMOVE_REPORT.DESCRIPTION"),buttons:[{title:i("APPS.POLICE.CANCEL")},{title:i("APPS.POLICE.REMOVE"),color:"red",cb:()=>{l.set({...l.value,reports:e.reports.filter((d,u)=>u!==a)})}}]}):C("Police",{action:"getReport",id:s.id},U.reports.find(d=>d.id===s.id)).then(d=>{if(!d)return v("error","Failed to fetch report");Ee.set(d),Ne.set("reports")})},children:[s.label," (",s.id,")"]},a))})]})]})]})]})})};export{l as ActiveWarrant,pe as default};
