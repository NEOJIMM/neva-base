const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-BNhu86hm.js","assets/index-B-vcvQz_.js","assets/index-nbUGgjxt.css","assets/Employees-BbNChSej.js","assets/Logs-tY7T5eIy.js"])))=>i.map(i=>d[i]);
import{$ as h,g as M,L as a,h as O,G as v,f as ce,ad as pe,u as T,r as C,j as t,m as _,a as n,o as J,H as ue,be as st,aD as Oe,bf as re,K as G,V as fe,k as H,ac as se,bg as Se,F as be,bh as z,a5 as me,W as Je,bi as ae,b3 as nt,a2 as ze,as as rt,bj as lt,U as oe,bk as Ke,av as $e,R as qe,I as Ye,bl as ct,bm as ot,a8 as Te,S as de,ae as ee,af as dt,ah as ge,ai as ke,al as At,bn as ut,bb as Ge,ag as mt,b as Pt,q as ye,N as he,ak as We,bo as Nt,bp as ht,bq as Ct,br as vt,bs as Et,b2 as pt,bt as St,bu as ft,bv as gt,bw as Lt,bx as Tt,b1 as It,by as Ot,bz as bt,bA as yt,bB as Mt,J as Ut,bC as te}from"./index-B-vcvQz_.js";const Ze=(e,i,c,r)=>{let m="";!h.APPS.AMBULANCE.permissions.value.tag.create&&h.APPS.AMBULANCE.tags.value.length===0||M.ContextMenu.set({buttons:[h.APPS.AMBULANCE.permissions.value.tag.create&&{title:a("APPS.POLICE.TAGS.CREATE_TAG.TITLE"),cb:()=>{M.PopUp.set({title:a("APPS.POLICE.TAGS.CREATE_TAG.TITLE"),description:a("APPS.POLICE.TAGS.CREATE_TAG.DESCRIPTION"),input:{placeholder:a("APPS.POLICE.TAGS.CREATE_TAG.PLACEHOLDER"),minCharacters:3,maxCharacters:20,onChange:u=>{m=u}},buttons:[{title:a("APPS.POLICE.TAGS.CREATE_TAG.CANCEL")},{title:a("APPS.POLICE.TAGS.CREATE_TAG.NEXT"),cb:()=>{M.ContextMenu.set({title:a("APPS.POLICE.TAGS.CREATE_TAG.SELECT_COLOR"),buttons:[...et.map(u=>({title:u,cb:()=>{u=u.toLowerCase(),O("Ambulance",{action:"createTag",data:{type:e,tag:m,color:u}},!0).then(A=>{if(!A)return v("error","createTag did not return an id (not success)");c!==!1?O("Ambulance",{action:"addTag",data:{type:e,id:i,tag:A}},!0).then(p=>{if(!p)return v("error","addTag did not return success");r&&r({id:A,type:e,title:m,color:u})}):r&&r({id:A,type:e,title:m,color:u})})}}))]})}}]})}},...h.APPS.AMBULANCE.tags.value.filter(u=>u.type===e).map(u=>({title:u.title,cb:()=>{c!==!1?O("Ambulance",{action:"addTag",data:{type:e,id:i,tag:u.id}},!0).then(A=>{if(!A)return v("error","addTag did not return success");r&&r({id:u.id,type:u.type,title:u.title,color:u.color})}):r&&r({id:u.id,type:u.type,title:u.title,color:u.color})}}))]})},Rt=(e,i)=>{if(!e)return v("error","No tag id provided");if(!h.APPS.AMBULANCE.permissions.value.tag.delete)return v("error","User does not have permission to delete tags");M.PopUp.set({title:a("APPS.POLICE.TAGS.DELETE_TAG.TITLE"),description:a("APPS.POLICE.TAGS.DELETE_TAG.DESCRIPTION"),buttons:[{title:a("APPS.POLICE.TAGS.DELETE_TAG.CANCEL")},{title:a("APPS.POLICE.TAGS.DELETE_TAG.DELETE"),cb:()=>{O("Ambulance",{action:"deleteTag",id:e},!0).then(c=>{if(!c)return v("error","deleteTag did not return success");v("info","Tag successfully deleted"),i==null||i()})}}]})},j={user:{id:"1",name:"LB Scripts",avatar:null,callsign:"[33-99]",rank:"Doctor"},permissions:{profile:{edit:!0},vehicle:{edit:!0},report:{create:!0,edit:!0,delete:!0},condition:{create:!0,delete:!0},bulletin:{create:!0,pin:!0,delete:!0},logs:{view:!0},chat:{create:!0,edit:!0,invite:!0,kick:!0},tag:{create:!0,delete:!0}},profiles:[{id:"1",name:"Breze",dob:"2002-07-19",isMale:!0,height:"180",online:!0,bloodType:"O+",phoneNumber:"1234567890",notes:"This is a note",tags:[{title:"Heart Condition",color:"red"}],diagnoses:[],reports:[]},{id:"2",name:"John Doe",dob:"2004-07-19",isMale:!1,height:"175",bloodType:"A+",diagnoses:[{title:"Autism",severity:"minor",id:"1"}]},{id:"3",name:"Loaf Scripts",dob:"2005-07-19",avatar:null,isMale:!0,height:"155",bloodType:"O+"}],reports:[{id:"1",title:"Heart Attack",description:"This report documents a medical emergency involving Breze, who experienced a heart attack. The patient was promptly attended to and received necessary medical intervention to stabilize their condition. The incident details, including symptoms, treatments, and observations, have been recorded for further analysis and follow-up care.",type:"Cardiac Arrest",patient:{name:"Breze",dob:"2002-07-19",id:"1"},tags:[{title:"Critical Care",color:"red"}],gallery:[],injuries:[{title:"Heart Attack",id:"CV001",severity:"critical"}],doctorsInvolved:[{name:"Loaf Scripts",id:"2"}],author:"LB Scripts",lastUpdated:new Date().getTime()}],employees:[{name:"Breze",rank:2,callsign:"33-99",onDuty:!0,phoneNumber:"0722312322"},{name:"Caden Cox",rank:1,callsign:"32-14",onDuty:!0,phoneNumber:"072231412"},{name:"Loaf Scripts",rank:1,callsign:"32-15",onDuty:!1,phoneNumber:"07223312"},{name:"John Doe",rank:1,callsign:"32-12",onDuty:!1,phoneNumber:"076551351"},{name:"Riley Smith",avatar:null,rank:0,callsign:"30-43",onDuty:!0,phoneNumber:"076521351"}],civilians:[{avatar:null,name:"Breze",dob:"2004-07-19",tags:[]},{avatar:null,name:"Loaf Scripts",dob:"2005-07-19",tags:[]},{avatar:null,name:"John Doe",dob:"2005-07-19"}],dispatch:{alarms:[{id:"4",priority:"high",code:"10-31",job:"ambulance",title:"Heart Attack",description:"Heart attack at the 24/7 Store",timestamp:new Date().getTime(),location:{label:"24/7 Store",coords:{x:1515.5,y:-555.3}}},{id:"5",title:"Injured Person",priority:"medium",job:"ambulance",code:"10-31",description:"Injured person at the Vanilla Unicorn",timestamp:new Date().getTime(),fields:[{icon:"IoAccessibility",label:"Injured",value:"1"},{icon:"IoFemale",label:"Suspect Gender",value:"Female"}],location:{label:"Vanilla Unicorn",coords:{x:0,y:0}}},{id:"6",title:"Nosebleed",job:"ambulance",description:"Nosebleed at the Fleeca Bank",priority:"low",code:"10-31",timestamp:new Date().getTime(),location:{label:"Fleeca Bank",coords:{x:-1e3,y:1400}}}],employees:[{source:1,name:"John Doe",callsign:"EMS-01",coords:{x:233.54,y:615.2},heading:0},{source:2,name:"Breze",callsign:"EMS-02",coords:{x:661.54,y:-515.2},heading:0},{source:3,name:"Loaf Scripts",callsign:"EMS-03",coords:{x:1156.54,y:551.2},inVehicle:!0,heading:0}]},chatRooms:{joined:[{id:"1",label:"General",lastMessage:"How are you guys?",avatar:null,notifications:2,private:!1,members:[{id:"1",name:"Loaf Scripts",avatar:null},{id:"2",name:"Breze",avatar:null}],messages:[{id:1,content:"Hello",timestamp:new Date().getTime(),sender:{name:"Loaf Scripts",avatar:null,id:"2"}},{id:1,content:"I SAID HI",timestamp:new Date().getTime(),sender:{name:"Loaf Scripts",avatar:null,id:"2"}},{id:3,content:"Hi",timestamp:new Date().getTime(),attachments:["./assets/img/icons/lbos.webp"],sender:{name:"Breze",avatar:null,id:"3"}},{id:4,content:"How are you guys?",timestamp:new Date().getTime(),sender:{name:"LB Scripts",avatar:null,id:"1"}}]},{id:"2",label:"Bosses",private:!0,avatar:null,creator:!0,members:[{id:"1",name:"Loaf Scripts",avatar:null},{id:"2",name:"Breze",avatar:null}]}],public:[{id:"3",label:"Coffee Break",avatar:null,notifications:0,private:!1,members:[{id:"1",name:"Loaf Scripts",avatar:null},{id:"2",name:"Breze",avatar:null}]}]},labels:{ambulance:"EMS",police:"LSPD"},ranks:{ambulance:[{grade:0,label:"Doctor"},{grade:1,label:"Paramedic"},{grade:2,label:"EMT"},{grade:3,label:"Trainee"},{grade:4,label:"Intern"},{grade:5,label:"Nurse"},{grade:6,label:"Surgeon"},{grade:7,label:"Boss"}]},logs:[{id:"1",relatedId:"1",username:"Breze",action:"create",type:"report",title:"Heart Attack",description:"This report documents a medical emergency involving Breze, who experienced a heart attack. The patient was promptly attended to and received necessary medical intervention to stabilize their condition. The incident details, including symptoms, treatments, and observations, have been recorded for further analysis and follow-up care.",timestamp:new Date().getTime()},{id:"2",relatedId:"1",username:"Breze",action:"update",type:"profile",title:"Breze",timestamp:new Date().getTime()}],bulletinBoard:[{id:"2",title:"Important announcement",content:"Please make sure to clean up after yourself in the changing rooms",timestamp:new Date().getTime(),author:"Loaf Scripts",pinned:!0},{id:"1",title:"Meeting at 12:00",content:"Meeting at 12:00 in the conference room",timestamp:new Date().getTime(),author:"Breze"}],activeUnits:[{source:1,name:"Robin Olsson",callsign:"10-1",rank:"Doctor"},{source:2,name:"Mateo Diaz",callsign:"10-2",rank:"Paramedic"},{source:3,name:"Tobias Karlsson",callsign:"30-3",rank:"EMT"}],conditions:{"Cardiovascular Conditions":[{title:"Heart Attack",color:"red",id:"CV001",severity:"critical"},{title:"Heart Failure",color:"red",id:"CV002",severity:"critical"},{title:"Coronary Artery Disease",color:"red",id:"CV003",severity:"moderate"},{title:"Stroke",color:"red",id:"CV004",severity:"critical"},{title:"Arrhythmia",color:"orange",id:"CV005",severity:"minor"},{title:"High Blood Pressure",color:"orange",id:"CV006",severity:"minor"},{title:"Angina",color:"orange",id:"CV007",severity:"minor"},{title:"Aortic Aneurysm",color:"red",id:"CV008",severity:"critical"},{title:"Deep Vein Thrombosis (DVT)",color:"red",id:"CV009",severity:"moderate"},{title:"Peripheral Artery Disease",color:"orange",id:"CV010",severity:"minor"}],"Orthopedic Injuries":[{title:"Broken Arm",color:"orange",id:"OR001",severity:"minor"},{title:"Broken Leg",color:"red",id:"OR002",severity:"moderate"},{title:"Fractured Hip",color:"red",id:"OR003",severity:"critical"},{title:"Torn ACL",color:"orange",id:"OR004",severity:"minor"},{title:"Dislocated Shoulder",color:"red",id:"OR005",severity:"moderate"},{title:"Sprained Ankle",color:"green",id:"OR006",severity:"minor"},{title:"Herniated Disc",color:"red",id:"OR007",severity:"moderate"},{title:"Pelvic Fracture",color:"red",id:"OR008",severity:"critical"},{title:"Rotator Cuff Tear",color:"orange",id:"OR009",severity:"minor"},{title:"Tennis Elbow",color:"green",id:"OR010",severity:"minor"}],"Neurological Conditions":[{title:"Concussion",color:"orange",id:"NR001",severity:"minor"},{title:"Traumatic Brain Injury",color:"red",id:"NR002",severity:"critical"},{title:"Epilepsy",color:"red",id:"NR003",severity:"moderate"},{title:"Multiple Sclerosis",color:"green",id:"NR004",severity:"serious"},{title:"Parkinson's Disease",color:"green",id:"NR005",severity:"serious"},{title:"Alzheimer’s Disease",color:"green",id:"NR006",severity:"serious"},{title:"Migraine",color:"orange",id:"NR007",severity:"minor"},{title:"Bell’s Palsy",color:"orange",id:"NR008",severity:"minor"},{title:"Spinal Cord Injury",color:"red",id:"NR009",severity:"critical"},{title:"Cluster Headaches",color:"orange",id:"NR010",severity:"minor"}],"Respiratory Conditions":[{title:"Pneumonia",color:"red",id:"RS001",severity:"moderate"},{title:"Asthma",color:"orange",id:"RS002",severity:"minor"},{title:"Chronic Obstructive Pulmonary Disease (COPD)",color:"green",id:"RS003",severity:"serious"},{title:"Lung Cancer",color:"red",id:"RS004",severity:"critical"},{title:"Tuberculosis (TB)",color:"red",id:"RS005",severity:"serious"},{title:"Sleep Apnea",color:"orange",id:"RS006",severity:"minor"},{title:"Bronchitis",color:"orange",id:"RS007",severity:"minor"},{title:"Pulmonary Embolism",color:"red",id:"RS008",severity:"critical"},{title:"Cystic Fibrosis",color:"green",id:"RS009",severity:"serious"}],"Gastrointestinal Conditions":[{title:"Appendicitis",color:"red",id:"GI001",severity:"moderate"},{title:"Crohn's Disease",color:"green",id:"GI002",severity:"serious"},{title:"Ulcerative Colitis",color:"green",id:"GI003",severity:"serious"},{title:"Gastroesophageal Reflux Disease (GERD)",color:"orange",id:"GI004",severity:"minor"},{title:"Irritable Bowel Syndrome (IBS)",color:"green",id:"GI005",severity:"serious"},{title:"Gallstones",color:"red",id:"GI006",severity:"moderate"},{title:"Pancreatitis",color:"red",id:"GI007",severity:"moderate"},{title:"Peptic Ulcer",color:"orange",id:"GI008",severity:"minor"},{title:"Hepatitis C",color:"green",id:"GI009",severity:"serious"}],"Infectious Diseases":[{title:"COVID-19",color:"red",id:"ID001",severity:"moderate"},{title:"Hepatitis",color:"green",id:"ID002",severity:"serious"},{title:"HIV/AIDS",color:"green",id:"ID003",severity:"serious"},{title:"Meningitis",color:"red",id:"ID004",severity:"critical"},{title:"Influenza (Flu)",color:"orange",id:"ID005",severity:"minor"},{title:"Malaria",color:"red",id:"ID006",severity:"moderate"},{title:"Ebola Virus Disease",color:"red",id:"ID007",severity:"critical"},{title:"Zika Virus",color:"orange",id:"ID008",severity:"minor"},{title:"Lyme Disease",color:"green",id:"ID009",severity:"serious"}],"Endocrine Disorders":[{title:"Type 1 Diabetes",color:"green",id:"ED001",severity:"serious"},{title:"Type 2 Diabetes",color:"green",id:"ED002",severity:"serious"},{title:"Thyroid Disorders",color:"orange",id:"ED003",severity:"minor"},{title:"Cushing’s Syndrome",color:"red",id:"ED004",severity:"moderate"},{title:"Adrenal Insufficiency (Addison’s Disease)",color:"red",id:"ED005",severity:"moderate"},{title:"Hyperthyroidism",color:"orange",id:"ED006",severity:"minor"},{title:"Polycystic Ovary Syndrome (PCOS)",color:"green",id:"ED007",severity:"serious"}],"Cancer Types":[{title:"Breast Cancer",color:"red",id:"CA001",severity:"critical"},{title:"Prostate Cancer",color:"red",id:"CA002",severity:"critical"},{title:"Skin Cancer",color:"orange",id:"CA003",severity:"serious"},{title:"Leukemia",color:"red",id:"CA004",severity:"critical"},{title:"Colon Cancer",color:"red",id:"CA005",severity:"critical"},{title:"Lymphoma",color:"red",id:"CA006",severity:"critical"},{title:"Pancreatic Cancer",color:"red",id:"CA007",severity:"critical"},{title:"Brain Cancer",color:"red",id:"CA008",severity:"critical"}],"Mental Health Conditions":[{title:"Depression",color:"red",id:"MH001",severity:"moderate"},{title:"Anxiety Disorder",color:"orange",id:"MH002",severity:"minor"},{title:"Bipolar Disorder",color:"green",id:"MH003",severity:"serious"},{title:"Post-Traumatic Stress Disorder (PTSD)",color:"red",id:"MH004",severity:"moderate"},{title:"Obsessive-Compulsive Disorder (OCD)",color:"orange",id:"MH005",severity:"minor"},{title:"Schizophrenia",color:"green",id:"MH006",severity:"serious"},{title:"Phobias",color:"orange",id:"MH007",severity:"minor"},{title:"Eating Disorders",color:"green",id:"MH008",severity:"serious"},{title:"Dementia",color:"red",id:"MH009",severity:"moderate"}]}};function Bt(){var m,u;const e=T(h.APPS.AMBULANCE.conditions),i=T(h.APPS.AMBULANCE.permissions),[c,r]=C.useState("");return t(_.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:t("main",{className:"main scrollable",children:n("div",{className:"page",children:[n("div",{className:"top",children:[t("div",{className:"title",children:a("APPS.AMBULANCE.CONDITIONS.TITLE")}),n("div",{className:"button",onClick:Xe,children:[t(J,{}),a("APPS.AMBULANCE.CONDITIONS.ADD_CATEGORY.TITLE")]})]}),t(ue,{placeholder:a("APPS.AMBULANCE.CONDITIONS.SEARCH"),onChange:A=>r(A.target.value)}),t("div",{className:"items",children:(u=(m=Object.keys(e))==null?void 0:m.filter(A=>e[A].length===0||e[A].filter(p=>{var P;return(P=p==null?void 0:p.title)==null?void 0:P.toLowerCase().includes(c.toLowerCase())}).length>0))==null?void 0:u.map((A,p)=>{var P,U;return n("div",{className:"grid-item",children:[n("div",{className:"top",children:[t("div",{className:"title",children:A}),n("div",{className:"buttons",children:[((P=i==null?void 0:i.condition)==null?void 0:P.create)&&n("div",{className:"button",onClick:()=>Me(A),children:[t(J,{}),a("APPS.AMBULANCE.CONDITIONS.ADD_CONDITION.TITLE")]}),((U=i==null?void 0:i.condition)==null?void 0:U.delete)&&Object.keys(e).length===0&&n("div",{className:"button red",children:[t(st,{}),a("APPS.AMBULANCE.CONDITIONS.DELETE_CATEGORY.TITLE")]})]})]}),n("div",{className:"items grid",style:{padding:"1rem 0.5rem"},children:[e[A].filter(R=>R.title.toLowerCase().includes(c.toLowerCase())).length===0&&t("div",{className:"no-results",children:a("APPS.AMBULANCE.CONDITIONS.NO_CONDITIONS_FOUND")}),e[A].filter(R=>R.title.toLowerCase().includes(c.toLowerCase())).map(R=>t(Dt,{data:R},R.id))]})]},p)})})]})})})}const Dt=({data:e})=>{const i=T(h.APPS.AMBULANCE.permissions),c=Oe(()=>{i.condition.delete&&M.PopUp.set({title:a("APPS.AMBULANCE.CONDITIONS.DELETE_CONDITION.TITLE"),description:a("APPS.AMBULANCE.CONDITIONS.DELETE_CONDITION.DESCRIPTION"),buttons:[{title:a("APPS.AMBULANCE.CANCEL")},{title:a("APPS.AMBULANCE.DELETE"),color:"red",cb:()=>{O("Ambulance",{action:"deleteCondition",id:e.id},!0).then(r=>{if(!r)return v("error","Failed to delete condition");if(pe()){const m=h.APPS.AMBULANCE.conditions.value,u=Object.keys(m).find(p=>m[p].find(P=>P.id===e.id)),A=m[u].filter(p=>p.id!==e.id);h.APPS.AMBULANCE.conditions.set({...m,[u]:A})}})}}]})});return n(_.div,{...re,...c,className:"item offence","data-color":Pe(e.severity),children:[t("div",{className:"item-header",children:t("div",{className:"title",children:e.title})}),n("div",{className:"item-footer",children:[t("div",{className:"id",children:e.id}),t("div",{className:"severity",children:a(`APPS.AMBULANCE.CONDITIONS.SEVERITIES.${e.severity.toUpperCase()}`)})]})]})},Xe=()=>{let e="";M.PopUp.set({title:a("APPS.AMBULANCE.CONDITIONS.ADD_CATEGORY.TITLE"),description:a("APPS.AMBULANCE.CONDITIONS.ADD_CATEGORY.DESCRIPTION"),input:{placeholder:a("APPS.AMBULANCE.CONDITIONS.ADD_CATEGORY.PLACEHOLDER"),onChange:i=>e=i},buttons:[{title:a("APPS.AMBULANCE.CANCEL")},{title:a("APPS.AMBULANCE.PROCEED"),cb:()=>{e&&O("Ambulance",{action:"addConditionCategory",category:e},!0).then(i=>{if(!i)return v("error","Failed to add category");pe()&&h.APPS.AMBULANCE.conditions.set({...h.APPS.AMBULANCE.conditions.value,[e]:[]})})}}]})},Me=e=>{if(!e)return;let i="";M.PopUp.set({title:a("APPS.AMBULANCE.CONDITIONS.ADD_CONDITION.TITLE"),description:a("APPS.AMBULANCE.CONDITIONS.ADD_CONDITION.DESCRIPTION"),input:{placeholder:a("APPS.AMBULANCE.CONDITIONS.ADD_CONDITION.PLACEHOLDER"),onChange:m=>i=m},buttons:[{title:a("APPS.AMBULANCE.CANCEL")},{title:a("APPS.AMBULANCE.PROCEED"),cb:()=>{i&&c()}}]});const c=()=>{setTimeout(()=>{var m;M.ContextMenu.set({title:a("APPS.AMBULANCE.CONDITIONS.SELECT_SEVERITY"),buttons:Object.keys((m=ce.value.Ambulance)==null?void 0:m.Severities).map(u=>({title:a(`APPS.AMBULANCE.CONDITIONS.SEVERITIES.${u.toUpperCase()}`),cb:()=>{r(u)}}))})})},r=m=>{O("Ambulance",{action:"addCondition",category:e,data:{title:i,severity:m}},!0).then(u=>{if(!u)return v("error","Failed to add condition");pe()&&h.APPS.AMBULANCE.conditions.set({...h.APPS.AMBULANCE.conditions.value,[e]:[...h.APPS.AMBULANCE.conditions.value[e],{id:Math.random().toString(36).substring(7),title:i,severity:m}]})})}},Pe=e=>ce.value.Ambulance.Severities[e]||"green",_t=Object.freeze(Object.defineProperty({__proto__:null,addCategory:Xe,addCondition:Me,default:Bt,getConditionColor:Pe},Symbol.toStringTag,{value:"Module"})),ie=G([]),b=G(null);function wt(){const e=T(ie),i=T(b),[c,r]=C.useState(""),[m,u]=C.useState(""),[A,p]=C.useState(0),[P,U]=C.useState(!1),[R,w]=C.useState(!1);C.useEffect(()=>{if(p(0),U(!1),c.length>0)O("Ambulance",{action:"searchProfiles",query:c,page:0},j.profiles.filter(o=>o.name.toLowerCase().includes(c.toLowerCase()))).then(o=>{if(!o)return v("info","searchProfiles did not return anything");ie.set(o)});else{let o=`${fe.value}-lb-tablet:recentAmbulanceProfiles`;ie.set(localStorage!=null&&localStorage.getItem(o)?JSON.parse(localStorage==null?void 0:localStorage.getItem(o)):[])}},[c]);const N=()=>{if(P||R)return;let o=document.querySelector("#last");if(!o)return;!me(o)&&(w(!0),O("Ambulance",{action:"searchProfiles",query:c,page:A+1},null).then(E=>{E&&E.length>0?(ie.set([...e,...E]),w(!1),E.length<10&&U(!0)):U(!0)}),p(E=>E+1))};C.useEffect(()=>{const o=setTimeout(()=>r(m),500);return()=>clearTimeout(o)},[m]),H("ambulance:profileUpdated",o=>{if(!o)return v("error","ambulance:profileUpdated did not return data");if(!o.id)return v("error","ambulance:profileUpdated did not return an id");i&&i.id===o.id?b.set({...b==null?void 0:b.value,avatar:o.avatar,notes:o.notes,diagnoses:o.diagnosis.map(g=>h.APPS.AMBULANCE.conditions.value.find(E=>E.id===g))}):ie.set(e.map(g=>g.id===o.id?{...g,avatar:o.avatar,notes:o.notes,diagnoses:o.diagnosis.map(E=>h.APPS.AMBULANCE.conditions.value.find(s=>s.id===E))}:g))});const L=o=>{if(!o)return v("error","fetchProfile did not receive an id");O("Ambulance",{action:"fetchProfile",id:o},j.profiles.find(g=>g.id===o)).then(g=>{if(!g)return v("info","fetchProfile did not return anything");b.set(g);let E=`${fe.value}-lb-tablet:recentAmbulanceProfiles`,s=JSON.parse(localStorage==null?void 0:localStorage.getItem(E))||[];s.unshift(g),s=s.filter((l,d,S)=>S.findIndex(f=>f.id===l.id)===d),localStorage.setItem(E,JSON.stringify(s))})};return t(_.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:i?t(se,{children:t(Ht,{})}):t("main",{className:"main profiles",children:n("div",{className:"page",children:[n("div",{className:"top",children:[t("div",{className:"title",children:a("APPS.AMBULANCE.JOURNALS.TITLE")}),t("div",{className:"button red",onClick:()=>{ie.reset(),localStorage.setItem(`${fe.value}-lb-tablet:recentAmbulanceProfiles`,JSON.stringify([]))},children:a("APPS.AMBULANCE.CLEAR_HISTORY")})]}),t(ue,{placeholder:a("APPS.AMBULANCE.JOURNALS.SEARCH"),onChange:o=>u(o.target.value)}),n("div",{className:"items",onScroll:N,children:[e.length===0&&c.length==0&&t("div",{className:"no-results",children:a("APPS.AMBULANCE.SEARCH_FOR",{query:a("APPS.AMBULANCE.JOURNALS.PERSON").toLowerCase()})}),e.length===0&&c.length>0&&t("div",{className:"no-results",children:a("APPS.AMBULANCE.NO_RESULTS_FOR",{query:c})}),e==null?void 0:e.map((o,g)=>{var s;let E=g===e.length-1?"last":"";return n(_.div,{...re,id:E,className:"item",onClick:()=>L(o.id),children:[t("img",{src:W(o.avatar)}),n("div",{className:"info",children:[t("div",{className:"name",children:o.name}),n("div",{className:"subtitle",children:[o.dob," (",Se(o.dob),")"]}),t("div",{className:"cards",children:((s=o.tags)==null?void 0:s.length)>0&&t(be,{children:o.tags.map(l=>t("div",{className:z("card",l.color),children:l.title}))})})]})]},g)})]})]})})})}const Ht=()=>{var U,R,w,N,L;const e=T(b),i=T(ie),c=T(h.APPS.AMBULANCE.permissions),[r,m]=C.useState(!1),u=C.useRef(!1),A=()=>{if(!e)return v("error","saveProfile did not receive a profile");if(!u.current){v("info","No edits made"),b.reset();return}O("Ambulance",{action:"updateProfile",data:{type:"player",id:e.id,notes:e.notes??"",avatar:e.avatar,diagnoses:e.diagnoses.map(o=>o.id)}},!0).then(o=>{if(!o)return v("error","saveProfile did not return success");ie.set(i.map(g=>g.id===e.id?{...g,avatar:e.avatar}:g)),b.reset()})};let p=C.useRef(!0);C.useEffect(()=>{if(e){if(p.current){p.current=!1;return}u.current=!0}},[e]),H("ambulance:tagAdded",o=>{const{type:g,id:E,tagId:s}=o;g==="profile"&&E===e.id&&b.set({...b==null?void 0:b.value,tags:[...e.tags??[],h.APPS.AMBULANCE.tags.value.find(l=>l.id===s)]})}),H("ambulance:tagRemoved",o=>{const{type:g,id:E,tagId:s}=o;g==="profile"&&E===e.id&&b.set({...b==null?void 0:b.value,tags:[...e.tags.filter(l=>l.id!==s)]})});const P=Oe(o=>{r&&e.avatar&&M.ContextMenu.set({buttons:[{title:a("APPS.AMBULANCE.JOURNALS.REMOVE_AVATAR"),color:"red",cb:()=>b.set({...b==null?void 0:b.value,avatar:null})}]})});return t(_.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{ease:"easeInOut",duration:.25},className:"grid-container",children:e&&n(be,{children:[n("div",{className:"grid-header",children:[n("div",{className:"back",onClick:()=>b.reset(),children:[t(Je,{})," ",a("APPS.AMBULANCE.BACK")]}),n("div",{className:"buttons",children:[r&&t("div",{className:"button red",onClick:()=>m(!1),children:a("APPS.AMBULANCE.CANCEL")}),((U=c==null?void 0:c.profile)==null?void 0:U.edit)&&t("div",{className:"button",onClick:()=>{r?A():m(!0)},children:r?a("APPS.AMBULANCE.SAVE"):a("APPS.AMBULANCE.EDIT")})]})]}),n("div",{className:"grid-body",style:{gridTemplateAreas:`
                                'profile tags'
                                'profile diagnoses'
                                'description reports'
                                'description .'
                                'description .'
                            `,overflowY:"auto",paddingBottom:"2rem"},children:[n("div",{className:"grid-item",style:{gridArea:"profile"},children:[t("div",{className:"top",children:t("div",{className:"title",children:a("APPS.AMBULANCE.JOURNALS.TITLE")})}),t("div",{className:"items",children:n("div",{className:"item profile",children:[n("div",{className:"left",children:[n("div",{className:"mugshot",children:[t("img",{...P,"data-hasavatar":!!e.avatar,src:W(e.avatar),onClick:()=>{e.avatar&&M.FullscreenImage.set(e.avatar)}}),!e.avatar&&r&&t(_.div,{...ae,className:"add",onClick:()=>{M.ContextMenu.set({title:a("APPS.AMBULANCE.JOURNALS.ADD_AVATAR.TITLE"),buttons:[{title:a("APPS.AMBULANCE.JOURNALS.ADD_AVATAR.SET_PHOTO"),cb:()=>{M.Gallery.set({includeVideos:!1,onSelect:o=>{b.set({...b==null?void 0:b.value,avatar:o.src})}})}},{title:a("APPS.AMBULANCE.JOURNALS.ADD_AVATAR.PASTE_URL"),cb:()=>{let o="";M.PopUp.set({title:a("APPS.AMBULANCE.JOURNALS.ADD_AVATAR.PASTE_URL"),description:a("APPS.AMBULANCE.JOURNALS.ADD_AVATAR.PASTE_URL_DESCRIPTION"),input:{placeholder:a("APPS.AMBULANCE.JOURNALS.ADD_AVATAR.PASTE_URL_PLACEHOLDER"),minCharacters:5,maxCharacters:500,onChange:g=>{o=g}},buttons:[{title:a("APPS.AMBULANCE.CANCEL")},{title:a("APPS.AMBULANCE.SAVE"),cb:()=>{let g=o;g.match(/\.(jpeg|jpg|gif|png)$/)!=null&&g.match(/http(s?):\/\//)!=null?b.set({...b==null?void 0:b.value,avatar:g}):(v("error","Invalid URL / Invalid image URL"),setTimeout(()=>{M.PopUp.set({title:a("APPS.AMBULANCE.JOURNALS.ADD_AVATAR.INVALID_URL"),description:a("APPS.AMBULANCE.JOURNALS.ADD_AVATAR.INVALID_URL_DESCRIPTION"),buttons:[{title:a("APPS.AMBULANCE.JOURNALS.ADD_AVATAR.OK")}]})},500))}}]})}}]})},children:t(J,{})})]}),n("div",{className:"info",children:[t("div",{className:"name",children:e.name}),t("div",{className:"job",children:e.dob})]})]}),n("div",{className:"details",children:[n("div",{className:"item",children:[t("span",{children:a("APPS.AMBULANCE.JOURNALS.DOB")}),n("div",{className:"value",children:[e.dob,n("span",{children:["(",Se(e.dob),")"]})]})]}),n("div",{className:"item",children:[t("span",{children:a("APPS.AMBULANCE.JOURNALS.PHONE_NR")}),t("div",{className:z("value",e.phoneNumber&&"blue"),children:e.phoneNumber?nt(e.phoneNumber):a("APPS.POLICE.MISC.UNKNOWN")})]}),n("div",{className:"item",children:[t("span",{children:a("APPS.AMBULANCE.JOURNALS.GENDER")}),n("div",{className:"value",children:[e.isMale?a("APPS.AMBULANCE.JOURNALS.MALE"):a("APPS.AMBULANCE.JOURNALS.FEMALE")," ",n("span",{children:["(",e.isMale?"M":"F",")"]})]})]}),e.height&&n("div",{className:"item",children:[t("span",{children:a("APPS.AMBULANCE.JOURNALS.HEIGHT")}),t("div",{className:"value",children:a("APPS.AMBULANCE.JOURNALS.HEIGHT_FORMAT",{height:e.height.toString()})})]}),e.bloodType&&n("div",{className:"item",children:[t("span",{children:a("APPS.AMBULANCE.JOURNALS.BLOOD_TYPE")}),t("div",{className:"value",children:e.bloodType})]})]})]})})]}),n("div",{className:"grid-item",style:{gridArea:"description"},children:[t("div",{className:"top",children:t("div",{className:"title",children:a("APPS.AMBULANCE.JOURNALS.NOTES")})}),t("div",{className:"items",children:t(ze,{className:"note",placeholder:a("APPS.AMBULANCE.JOURNALS.NOTES_PLACEHOLDER"),defaultValue:e.notes,disabled:!r,onChange:o=>b.set({...b==null?void 0:b.value,notes:o.target.value}),style:{height:"20rem"}})})]}),n("div",{className:"grid-item",style:{gridArea:"tags"},children:[n("div",{className:"top",children:[t("div",{className:"title",children:a("APPS.POLICE.TAGS.TITLE")}),r&&n(_.div,{...ae,className:"button",onClick:()=>{Ze("profile",e.id,!0,o=>b.set({...b==null?void 0:b.value,tags:[...(e==null?void 0:e.tags)??[],o]}))},children:[t(J,{}),a("APPS.POLICE.TAGS.ADD")]})]}),n("div",{className:"items",children:[(!e.tags||((R=e==null?void 0:e.tags)==null?void 0:R.length)===0)&&t("div",{className:"no-results",children:a("APPS.POLICE.TAGS.NO_TAGS")}),t("div",{className:"cards",children:(w=e==null?void 0:e.tags)==null?void 0:w.map((o,g)=>t(Ue,{tag:o,editMode:r,cb:()=>{b.set({...b==null?void 0:b.value,tags:e.tags.filter(E=>E.id!==o.id)})}},g))})]})]}),n("div",{className:"grid-item",style:{gridArea:"diagnoses"},children:[n("div",{className:"top",children:[n("div",{className:"title",children:[" ",a("APPS.AMBULANCE.JOURNALS.DIAGNOSES_DISEASES")]}),r&&n(_.div,{...ae,className:"button",onClick:()=>{K.set({type:"conditions",onSelect:o=>{b.set({...b.value,diagnoses:[...e.diagnoses??[],{id:o.id,title:o.title,severity:o.severity}]})}})},children:[t(J,{}),a("APPS.POLICE.TAGS.ADD")]})]}),n("div",{className:"items",children:[(!e.diagnoses||e.diagnoses.length===0)&&t("div",{className:"no-results",children:a("APPS.AMBULANCE.JOURNALS.NO_DIAGNOSES")}),t("div",{className:"cards",children:(N=e.diagnoses)==null?void 0:N.map((o,g)=>t("div",{className:z("card",Pe(o.severity),r&&"clickable"),onClick:()=>{r&&b.set({...b.value,diagnoses:e.diagnoses.filter(E=>E.id!==o.id)})},children:o.title},g))})]})]}),n("div",{className:"grid-item",style:{gridArea:"reports"},children:[t("div",{className:"top",children:t("div",{className:"title",children:a("APPS.AMBULANCE.JOURNALS.REPORTS")})}),n("div",{className:"items",children:[(!e.reports||e.reports.length===0)&&t("div",{className:"no-results",children:a("APPS.AMBULANCE.JOURNALS.NO_REPORTS")}),t("div",{className:"cards",children:(L=e.reports)==null?void 0:L.map((o,g)=>n("div",{className:"card blue clickable",onClick:()=>tt(o.id),children:[o.title," (",o.id,")"]},g))})]})]})]})]})})},Vt=Object.freeze(Object.defineProperty({__proto__:null,SelectedProfile:b,default:wt},Symbol.toStringTag,{value:"Module"}));function kt(){var i,c,r,m,u,A;const e=T(ce);return n("header",{className:"ambulance-header",children:[n("div",{className:"ambulance-info",children:[t("img",{className:"logo",src:(c=(i=e.Ambulance)==null?void 0:i.Header)==null?void 0:c.Logo}),n("div",{className:"text",children:[t("div",{className:"name",children:(m=(r=e.Ambulance)==null?void 0:r.Header)==null?void 0:m.Title}),t("div",{className:"device",children:(A=(u=e.Ambulance)==null?void 0:u.Header)==null?void 0:A.Subtitle})]})]}),t(Gt,{})]})}const Gt=()=>{var c,r,m,u;const e=T(Z),i=T(ce);return n("div",{className:"user",children:[n("div",{className:"details",children:[t("div",{className:"callsign","data-clickable":(r=(c=i==null?void 0:i.Ambulance)==null?void 0:c.Callsign)==null?void 0:r.AllowChange,onClick:()=>{var P,U,R,w;if(!((U=(P=i==null?void 0:i.Ambulance)==null?void 0:P.Callsign)!=null&&U.AllowChange))return;let A="",p=!1;M.PopUp.set({title:a("APPS.POLICE.MISC.CALLSIGN.TITLE"),description:a("APPS.POLICE.MISC.CALLSIGN.DESCRIPTION"),input:{type:"text",minCharacters:1,maxCharacters:15,placeholder:`[${(w=(R=i==null?void 0:i.Ambulance)==null?void 0:R.Callsign)==null?void 0:w.Format}]`,defaultValue:e==null?void 0:e.callsign,onChange:N=>{var L,o;(o=(L=i==null?void 0:i.Ambulance)==null?void 0:L.Callsign)!=null&&o.RequireTemplate&&(p=at(N)),A=N}},buttons:[{title:a("APPS.POLICE.MISC.CALLSIGN.CANCEL")},{title:a("APPS.POLICE.MISC.CALLSIGN.PROCEED"),cb:()=>{var N,L;if(!A)return v("error","No input for callsign");if((L=(N=i==null?void 0:i.Ambulance)==null?void 0:N.Callsign)!=null&&L.RequireTemplate&&!p)return v("warning","Callsign does not follow format, returning");O("Ambulance",{action:"updateUser",data:{...e,callsign:A}},!0).then(o=>{if(!o)return v("error","Failed to remove avatar, no cb");Z.patch({callsign:A})})}}]})},children:(e==null?void 0:e.callsign)??((u=(m=i==null?void 0:i.Ambulance)==null?void 0:m.Callsign)!=null&&u.AllowChange?a("APPS.POLICE.MISC.SET_CALLSIGN"):a("APPS.POLICE.MISC.CALLSIGN.TITLE"))}),t("div",{className:"name",children:(e==null?void 0:e.name)??a("APPS.POLICE.MISC.UNKNOWN")}),t("div",{className:"rank",children:(e==null?void 0:e.rank)??"???"})]}),t("img",{src:W(e==null?void 0:e.avatar),onClick:()=>{M.ContextMenu.set({buttons:[{title:a("APPS.POLICE.MISC.CHANGE_AVATAR"),cb:()=>{M.Gallery.set({includeVideos:!1,onSelect:A=>{O("Ambulance",{action:"updateUser",data:{...e,avatar:A.src}},!0).then(p=>{if(!p)return v("error","Failed to remove avatar, no cb");Z.patch({avatar:A.src})})}})}},(e==null?void 0:e.avatar)!==void 0&&{title:a("APPS.POLICE.MISC.REMOVE_AVATAR"),color:"red",cb:()=>{O("Ambulance",{action:"updateUser",data:{...e,avatar:void 0}},!0).then(A=>{if(!A)return v("error","Failed to remove avatar, no cb");Z.patch({avatar:void 0})})}}]})}})]})};function xt({theme:e}){return t("div",{className:"loading",style:{backgroundColor:e==="dark"?"#000000":"#ffffff"},children:t(rt,{size:45,lineWeight:5,speed:2,color:e==="dark"?"#fff":"#000"})})}const Ft=(e,i,c)=>{let r=j[e];switch(e){case"reports":return r.filter(m=>m.title.toLowerCase().includes(c.toLowerCase()));case"profiles":return r.filter(m=>m.name.toLowerCase().includes(c.toLowerCase()));case"conditions":return r}},Le={reports:"getReports",profiles:"searchProfiles",conditions:"getConditions"};var xe,Fe,je;const jt={reports:(xe=a("APPS.AMBULANCE.REPORTS.REPORT"))==null?void 0:xe.toLowerCase(),profiles:(Fe=a("APPS.AMBULANCE.JOURNALS.PROFILES"))==null?void 0:Fe.toLowerCase(),conditions:(je=a("APPS.AMBULANCE.CONDITIONS.CONDITION"))==null?void 0:je.toLowerCase()};function Jt(){var E;const e=T(K),[i,c]=C.useState([]),r=T(h.APPS.AMBULANCE.permissions),m=T(h.APPS.AMBULANCE.conditions),[u,A]=C.useState(""),[p,P]=C.useState(""),[U,R]=C.useState(0),[w,N]=C.useState(!1),[L,o]=C.useState(!1);C.useEffect(()=>{const s=setTimeout(()=>A(p),500);return()=>clearTimeout(s)},[p]),C.useEffect(()=>{if(!((e==null?void 0:e.type)==="conditions"&&u.length>0)){if((e==null?void 0:e.type)==="conditions"&&h.APPS.AMBULANCE.conditions.value)return c(Object.keys(h.APPS.AMBULANCE.conditions.value));if(u.length===0&&(e==null?void 0:e.type)!=="conditions"){c([]),R(0),o(!1);return}O("Ambulance",{action:Le[e==null?void 0:e.type],query:u,filter:{[e==null?void 0:e.filter]:!0}},Ft(e==null?void 0:e.type,e==null?void 0:e.filter,u)).then(s=>{if(!s)return v("info",`${Le[e==null?void 0:e.type]} did not return anything`);c(s),(e==null?void 0:e.type)==="conditions"&&h.APPS.AMBULANCE.conditions.set(s)})}},[u]);const g=()=>{var d;if(L||w||(e==null?void 0:e.type)==="conditions")return;let s=document.querySelector("#last");if(!s)return;!me(s)&&(N(!0),O("Ambulance",{action:Le[e==null?void 0:e.type],query:u,filter:e==null?void 0:e.filter,lastId:(d=i[i.length-1])==null?void 0:d.id},null).then(S=>{S&&S.length>0?(c([...i,...S]),N(!1),S.length<15&&o(!0)):o(!0)}))};return t(_.div,{initial:{y:250,opacity:.5},animate:{y:0,opacity:1},exit:{y:250,opacity:.5},transition:{ease:"easeInOut",duration:.25},className:"policepage-container absolute",children:t("main",{className:"main profile",children:n("div",{className:"page",children:[t("div",{className:"top",children:t("div",{className:"cancel",onClick:()=>K.reset(),children:a("APPS.AMBULANCE.CANCEL")})}),t(ue,{placeholder:a("APPS.AMBULANCE.SEARCH"),onChange:s=>P(s.target.value)}),n("div",{className:"items",onScroll:g,children:[i.length===0&&u.length==0&&t("div",{className:"no-results",children:a("APPS.AMBULANCE.SEARCH_FOR",{query:jt[e==null?void 0:e.type]})}),i.length===0&&u.length>0&&t("div",{className:"no-results",children:a("APPS.AMBULANCE.NO_RESULTS_FOR",{query:u})}),(E=i==null?void 0:i.filter(s=>{var l,d;return(e==null?void 0:e.type)==="conditions"?m[s].length===0||((l=m[s].filter(S=>{var f;return(f=S==null?void 0:S.title)==null?void 0:f.toLowerCase().includes(u.toLowerCase())}))==null?void 0:l.length)>0:!((d=e==null?void 0:e.exclude)!=null&&d.includes(s.id))}))==null?void 0:E.map((s,l)=>{var S,f,k;let d=l===i.length-1?"last":"";switch(e==null?void 0:e.type){case"profiles":return n(_.div,{...re,id:d,className:z("item",{profile:!0}),onClick:()=>{e==null||e.onSelect(s),K.reset()},children:[t("img",{src:W(s.avatar)}),n("div",{className:"info",children:[t("div",{className:"name",children:s.name}),t("div",{className:"subtitle",children:`${s.dob} (${Se(s.dob)})`}),t("div",{className:"cards",children:(S=s.tags)==null?void 0:S.map(V=>t("div",{className:z("card",V.color),children:V.title}))})]})]},l);case"reports":return n(_.div,{...re,id:d,className:"item incident",onClick:()=>{e==null||e.onSelect(s),K.reset()},children:[t("div",{className:"name",children:s.title}),n("div",{className:"subtitle",children:[s.type," - ",(f=s.description)==null?void 0:f.substring(0,200),"..."]}),t("div",{className:"cards",children:(k=s.tags)==null?void 0:k.map((V,Ne)=>t("div",{className:z("card",V.color),children:V.title},Ne))}),n("div",{className:"id report",style:{marginTop:"auto"},children:[t("div",{className:"label",children:a("APPS.AMBULANCE.REPORTS.FOOTER",{author:s.author,id:s.id})}),t("div",{className:"value",children:lt(s.lastUpdated)})]})]},l);case"conditions":return n("div",{className:"grid-item",children:[n("div",{className:"top",children:[t("div",{className:"title",children:s}),r.condition.create&&n("div",{className:"button",onClick:()=>Me(s),children:[t(J,{}),a("APPS.AMBULANCE.CONDITIONS.ADD_CONDITION.TITLE")]})]}),n("div",{className:"items grid",style:{padding:"1rem 0.5rem"},children:[m[s].filter(V=>V.title.toLowerCase().includes(u.toLowerCase())).length===0&&t("div",{className:"no-results",children:a("APPS.AMBULANCE.CONDITIONS.NO_CONDITIONS_FOUND")}),m[s].filter(V=>V.title.toLowerCase().includes(u.toLowerCase())).map(V=>n(_.div,{...re,className:"item offence","data-color":Pe(V.severity),onClick:()=>{e==null||e.onSelect(V),K.reset()},children:[t("div",{className:"item-header",children:t("div",{className:"title",children:V.title})}),n("div",{className:"item-footer",children:[t("div",{className:"id",children:V.id}),t("div",{className:"severity",children:a(`APPS.AMBULANCE.CONDITIONS.SEVERITIES.${V.severity.toUpperCase()}`)})]})]},V.id))]})]})}})]})]})})})}const Ce=G(null);function zt(){const e=T(Ce),[i,c]=C.useState(null);return C.useEffect(()=>{e&&c(e)},[e]),t("div",{className:"modal-container",onClick:r=>{r.target===r.currentTarget&&Ce.set(null)},children:n(_.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},className:"modal-content",children:[n("div",{className:"top",children:[t("div",{className:"title",children:i==null?void 0:i.title}),t("div",{className:"button red",onClick:()=>Ce.set(null),children:a("APPS.AMBULANCE.CLOSE")})]}),t("div",{className:"content",children:i==null?void 0:i.content}),(i==null?void 0:i.footer)&&t("div",{className:"footer",children:i==null?void 0:i.footer})]})})}const B=G([]),q=G(null),ve=G("joined"),Ae=G(0);function Kt(){var E;const e=T(B),i=T(q),c=T(ve),r=T(h.APPS.AMBULANCE.permissions),[m,u]=C.useState(""),[A,p]=C.useState(""),[P,U]=C.useState(0),[R,w]=C.useState(!1),[N,L]=C.useState(!1);C.useEffect(()=>{var s;if(oe("Ambulance")){if(U(0),w(!1),c==="joined"&&h.APPS.AMBULANCE.chatrooms.value&&m.length===0){B.set(h.APPS.AMBULANCE.chatrooms.value);return}O("Ambulance",{action:c==="joined"?"getChatRooms":"getPublicChatRooms",query:m},((s=j.chatRooms[c])==null?void 0:s.filter(l=>l.label.toLowerCase().includes(m.toLowerCase())))||[]).then(l=>{if(!l)return v("warning","No data received");B.set(l),m.length===0&&c==="joined"&&h.APPS.AMBULANCE.chatrooms.reset()})}},[c,m]);const o=()=>{if(R||N)return;let s=document.querySelector("#last");if(!s)return;!me(s)&&(L(!0),O("Ambulance",{action:c==="joined"?"getChatRooms":"getPublicChatRooms",page:P+1,query:m},null).then(d=>{d&&d.length>0?(B.set([...B.value,...d]),L(!1),d.length<25&&w(!0)):w(!0)}),U(d=>d+1))};C.useEffect(()=>{const s=setTimeout(()=>u(A),500);return()=>clearTimeout(s)},[A]),H("chat:leaveChatRoom",s=>{if(!s)return v("warning","No chatroom ID received");(i==null?void 0:i.id)===s&&q.reset(),B.set(e.filter(l=>l.id!==s)),h.APPS.AMBULANCE.chatrooms.set(e.filter(l=>l.id!==s))}),H("chat:joinChatRoom",s=>{var l;if(!s)return v("warning","No chatroom data received");B.set([...e,s]),h.APPS.AMBULANCE.chatrooms.set([...(l=h.APPS.AMBULANCE.chatrooms)==null?void 0:l.value,s])}),H("chat:setChatAvatar",s=>{const{id:l,avatar:d}=s;if(!l)return v("warning","No chatroom ID received");if(!d)return v("warning","No avatar received");if(!e.find(f=>f.id===l)&&(i==null?void 0:i.id)===l)return v("warning","Chatroom not found");let S=e.map(f=>f.id===l?{...f,avatar:d}:f);B.set(S),c==="joined"&&h.APPS.AMBULANCE.chatrooms.set(S),(i==null?void 0:i.id)===l&&q.patch({avatar:d})}),H("chat:setPrivate",s=>{const{id:l,private:d}=s;if(!l)return v("warning","No chatroom ID received");if(!e.find(f=>f.id===l))return v("warning","Chatroom not found");let S=e.map(f=>f.id===l?{...f,private:d}:f);(i==null?void 0:i.id)===l&&q.patch({private:d}),c==="joined"?(h.APPS.AMBULANCE.chatrooms.set(S),B.set(S)):B.set(B.value.filter(f=>f.id!==l))}),H("chat:newMessage",s=>{if((i==null?void 0:i.id)===s.id||!e.find(d=>d.id===s.id))return;let l=e.map(d=>d.id===s.id?{...d,lastMessage:s.message.content??"<!ATTACHMENT!>",timestamp:Date.now()}:d);B.set(l),c==="joined"&&h.APPS.AMBULANCE.chatrooms.set(l)});const g=()=>{let s;ve.set("joined"),M.PopUp.set({title:a("APPS.AMBULANCE.CHAT.CREATE_CHATROOM.TITLE"),description:a("APPS.AMBULANCE.CHAT.CREATE_CHATROOM.DESCRIPTION"),inputs:[{type:"text",placeholder:a("APPS.AMBULANCE.CHAT.CREATE_CHATROOM.PLACEHOLDER"),minCharacters:3,maxCharacters:20,onChange:d=>s=d}],buttons:[{title:a("APPS.AMBULANCE.CANCEL")},{title:a("APPS.AMBULANCE.CHAT.CREATE_CHATROOM.CREATE"),cb:()=>{setTimeout(()=>{M.ContextMenu.set({title:a("APPS.AMBULANCE.CHAT.CREATE_CHATROOM.SET_VISIBILITY"),buttons:[{title:a("APPS.AMBULANCE.CHAT.CREATE_CHATROOM.PUBLIC"),cb:()=>l(!1)},{title:a("APPS.AMBULANCE.CHAT.CREATE_CHATROOM.PRIVATE"),color:"red",cb:()=>l(!0)}]})},250)}}]});const l=d=>{O("Ambulance",{action:"createChat",data:{name:s,private:d}},parseInt(Math.random().toString(36).substring(7))).then(S=>{var f;if(!S)return v("error","Failed to create chatroom");B.set([...B.value,{id:S,label:s,creator:!0,private:d}]),h.APPS.AMBULANCE.chatrooms.set([...(f=h.APPS.AMBULANCE.chatrooms)==null?void 0:f.value,{id:S,label:s,creator:!0,private:d}])})}};return t(_.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:n("main",{className:"main chat",children:[n("div",{className:"chats",children:[n("div",{className:"top",children:[t("div",{className:"title",children:c==="joined"?a("APPS.AMBULANCE.CHAT.JOINED_CHATS"):a("APPS.AMBULANCE.CHAT.PUBLIC_CHATS")}),((E=r==null?void 0:r.chat)==null?void 0:E.create)&&n("div",{className:"button",onClick:g,children:[t(J,{}),a("APPS.AMBULANCE.CREATE")]})]}),t("div",{className:"selector",children:["joined","public"].map(s=>t("div",{className:"option","data-active":c===s,onClick:()=>ve.set(s),children:a(`APPS.AMBULANCE.CHAT.${s.toUpperCase()}`)},s))}),t(ue,{placeholder:a("APPS.AMBULANCE.CHAT.SEARCH"),onChange:s=>p(s.target.value)}),t("div",{className:"items",onScroll:o,children:e.sort((s,l)=>s.timestamp>l.timestamp?-1:1).map(s=>{var S;let l=e[e.length-1].id===s.id?"last":"",d=(s==null?void 0:s.lastMessage)==="<!ATTACHMENT!>"?"Attachment":((S=s==null?void 0:s.lastMessage)==null?void 0:S.length)>25?(s==null?void 0:s.lastMessage.slice(0,25))+"...":s==null?void 0:s.lastMessage;return C.createElement(_.div,{...re,key:s.id,id:l,className:"item",onClick:()=>{if(c==="joined"){if(s.id===(i==null?void 0:i.id))return q.reset();s.notifications&&O("Ambulance",{action:"clearNotifications",id:s.id}).then(()=>{Ae.set(Ae.value-s.notifications),B.set(B.value.map(f=>f.id===s.id?{...f,notifications:0}:f))}),q.set(s)}else M.PopUp.set({title:a("APPS.AMBULANCE.CHAT.JOIN_CHAT.TITLE"),description:a("APPS.AMBULANCE.CHAT.JOIN_CHAT.DESCRIPTION",{channel:s.label}),buttons:[{title:a("APPS.AMBULANCE.CANCEL")},{title:a("APPS.AMBULANCE.CHAT.JOIN_CHAT.JOIN"),cb:()=>{O("Ambulance",{action:"joinChat",id:s.id},!0).then(f=>{var k;if(!f)return M.PopUp.set({title:a("APPS.AMBULANCE.CHAT.ERROR.TITLE"),description:a("APPS.AMBULANCE.CHAT.ERROR.FAILED_JOIN"),buttons:[{title:a("APPS.AMBULANCE.OK")}]});B.set(e.filter(V=>V.id!==s.id)),h.APPS.AMBULANCE.chatrooms.set([...(k=h.APPS.AMBULANCE.chatrooms)==null?void 0:k.value,s])})}}]})}},t("img",{src:W(s.avatar)}),n("div",{className:"info",children:[n("div",{className:"label",children:[s.label,(s==null?void 0:s.private)&&t(Ke,{})]}),s.lastMessage&&t("div",{className:"content",children:d})]}),s.notifications?t("div",{className:"notifications",children:s.notifications}):null)})})]}),t("div",{className:"chats room",children:t(se,{children:i&&t($t,{})})})]})})}const $t=()=>{const e=T(de),i=T(q),c=T(ve),r=T(Z),m=T(h.APPS.AMBULANCE.permissions),[u,A]=C.useState([]),[p,P]=C.useState(!1),[U,R]=C.useState(!1),w=C.useRef(!1),[N,L]=C.useState({content:"",attachments:[]}),o=C.useRef(null);+C.useEffect(()=>{var s;if(A([]),!!i)return O("Ambulance",{action:"getMessages",id:i.id},((s=j.chatRooms[c].find(l=>(l==null?void 0:l.id)===(i==null?void 0:i.id)))==null?void 0:s.messages)||[]).then(l=>{if(l&&l.length>0){A([...l.reverse()]);let d=document.querySelector(".message-body");if(!d)return;d.scrollTop=d.scrollHeight}else P(!0)}),()=>{w.current&&O("Ambulance",{action:"clearChatNotifications ",id:i.id})}},[i]);const g=()=>{if(!N.content&&N.attachments.length===0)return v("warning","No message or attachments to send");let s={content:N.content,attachments:N.attachments,timestamp:new Date().getTime(),sender:{id:r.id,name:r.name,avatar:r.avatar}};if(e.airplaneMode)return A(l=>[...l,{...s,delivered:!1}]);O("Ambulance",{action:"sendMessage",id:i.id,...s},!0).then(l=>{l?(v("info","Successfully sent message, adding it?"),A(d=>[...d,{...s,id:l,delivered:!0}])):(v("error","Failed to send message"),A(d=>[...d,{...s,delivered:!1}])),L({content:"",attachments:[]}),o.current.value=""})},E=()=>{var d;if(p||U)return;let s=document.querySelector("#last");if(!s)return;!me(s)&&(R(!0),O("Ambulance",{action:"getMessages",id:i.id,lastId:(d=u[0])==null?void 0:d.id},null).then(S=>{S&&S.length>0?(A(f=>[...S.reverse(),...f]),R(!1),S.length<25&&P(!0)):P(!0)}))};return H("chat:newMessage",s=>{if(v("info","Received new message",s),!(s!=null&&s.message)||!(s!=null&&s.id))return v("warning","No message or id received");if(i.id!==s.id)return;if(e.airplaneMode)return v("warning","Airplane mode is enabled, not receiving message");if(s.message.sender.id!==r.id){A(S=>[...S,s.message]);let d=document.querySelector(".message-body");if(!d)return;d.scrollTop=d.scrollHeight}w.current=!0;let l=B.value.map(d=>d.id===s.id?{...d,lastMessage:s.message.content??"<!ATTACHMENT!>",timestamp:Date.now()}:d);B.set(l),c==="joined"&&h.APPS.AMBULANCE.chatrooms.set(l)}),t(_.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.2},className:"chatroom",children:i&&n(be,{children:[n("div",{className:"top",children:[n("div",{className:"title",children:[t("img",{src:W(i==null?void 0:i.avatar)}),n("div",{className:"info",children:[n("div",{className:"label",children:[i==null?void 0:i.label,(i==null?void 0:i.private)&&t(Ke,{})]}),t("div",{className:"value",children:a("APPS.AMBULANCE.CHAT.ROOM_ID",{id:i==null?void 0:i.id})})]})]}),n("div",{className:"buttons",children:[t("div",{className:"button",onClick:()=>{let s=[((i==null?void 0:i.creator)||m.chat.invite)&&{title:"Invite",cb:()=>{K.set({type:"profiles",filter:"ambulanceOnly",exclude:[r.id],onSelect:l=>{O("Ambulance",{action:"inviteToChat",id:i.id,user:l.id},!0).then(d=>{if(!d)return M.PopUp.set({title:a("APPS.AMBULANCE.CHAT.ERROR.TITLE"),description:a("APPS.AMBULANCE.CHAT.ERROR.DESCFRIPTION",{name:l.name}),buttons:[{title:a("APPS.AMBULANCE.OK")}]});v("info","Successfully invited user"),M.PopUp.set({title:a("APPS.AMBULANCE.CHAT.SUCCESS.TITLE"),description:a("APPS.AMBULANCE.CHAT.SUCCESS.DESCRIPTION",{name:l==null?void 0:l.name}),buttons:[{title:a("APPS.AMBULANCE.OK")}]})})}})}},((i==null?void 0:i.creator)||m.chat.edit)&&{title:a("APPS.AMBULANCE.CHAT.TOGGLE_PRIVATE"),cb:()=>{O("Ambulance",{action:"togglePrivate",id:i.id,toggle:!i.private},!0).then(l=>{var d,S;if(!l)return M.PopUp.set({title:"Error",description:"Failed to set password",buttons:[{title:"OK"}]});pe()&&(q.patch({private:!i.private}),B.set(B==null?void 0:B.value.map(f=>f.id===i.id?{...f,private:!i.private}:f)),c==="joined"&&h.APPS.AMBULANCE.chatrooms.set((S=(d=h.APPS.AMBULANCE.chatrooms)==null?void 0:d.value)==null?void 0:S.map(f=>f.id===i.id?{...f,private:!i.private}:f)))})}},((i==null?void 0:i.creator)||m.chat.edit)&&{title:i!=null&&i.avatar?a("APPS.AMBULANCE.CHAT.CHANGE_AVATAR"):a("APPS.AMBULANCE.CHAT.SET_AVATAR"),cb:()=>{M.Gallery.set({onSelect:l=>{O("Ambulance",{action:"setChatRoomAvatar",id:i.id,avatar:l==null?void 0:l.src},!0).then(d=>{var S,f;if(!d)return M.PopUp.set({title:a("APPS.AMBULANCE.CHAT.ERROR.TITLE"),description:a("APPS.AMBULANCE.CHAT.ERROR.FAILED_SET_AVATAR"),buttons:[{title:a("APPS.AMBULANCE.OK")}]});q.patch({avatar:l==null?void 0:l.src}),B.set(B==null?void 0:B.value.map(k=>k.id===i.id?{...k,avatar:l==null?void 0:l.src}:k)),c==="joined"&&h.APPS.AMBULANCE.chatrooms.set((f=(S=h.APPS.AMBULANCE.chatrooms)==null?void 0:S.value)==null?void 0:f.map(k=>k.id===i.id?{...k,avatar:l==null?void 0:l.src}:k))})}})}},((i==null?void 0:i.creator)||m.chat.edit)&&(i==null?void 0:i.avatar)&&{title:a("APPS.AMBULANCE.CHAT.REMOVE_AVATAR"),color:"red",cb:()=>{O("Ambulance",{action:"setChatRoomAvatar",id:i.id,avatar:null},!0).then(l=>{var d,S;if(!l)return M.PopUp.set({title:a("APPS.AMBULANCE.CHAT.ERROR.TITLE"),description:a("APPS.AMBULANCE.CHAT.ERROR.FAILED_REMOVE_AVATAR"),buttons:[{title:a("APPS.AMBULANCE.OK")}]});q.patch({avatar:null}),B.set(B==null?void 0:B.value.map(f=>f.id===i.id?{...f,avatar:null}:f)),c==="joined"&&h.APPS.AMBULANCE.chatrooms.set((S=(d=h.APPS.AMBULANCE.chatrooms)==null?void 0:d.value)==null?void 0:S.map(f=>f.id===i.id?{...f,avatar:null}:f))})}},m.chat.kick&&{title:a("APPS.AMBULANCE.CHAT.KICK.TITLE"),color:"red",cb:()=>{var l;O("Ambulance",{action:"getChatMembers",id:i.id},((l=j.chatRooms[c].find(d=>d.id===i.id))==null?void 0:l.members)||[]).then(d=>{if(!d)return M.PopUp.set({title:a("APPS.AMBULANCE.CHAT.ERROR.TITLE"),description:a("APPS.AMBULANCE.CHAT.ERROR.FAILED_GET_MEMBERS"),buttons:[{title:a("APPS.AMBULANCE.OK")}]});setTimeout(()=>{M.ContextMenu.set({title:a("APPS.AMBULANCE.CHAT.KICK.TITLE"),buttons:d.map(S=>({title:S.name,cb:()=>{M.PopUp.set({title:a("APPS.AMBULANCE.CHAT.KICK.TITLE"),description:a("APPS.AMBULANCE.CHAT.KICK.DESCRIPTION",{name:S.name}),buttons:[{title:a("APPS.AMBULANCE.CANCEL")},{title:a("APPS.AMBULANCE.CHAT.KICK.TITLE"),color:"red",cb:()=>{O("Ambulance",{action:"kickFromChat",id:i.id,user:S.id},!0).then(f=>{if(!f)return M.PopUp.set({title:a("APPS.AMBULANCE.CHAT.ERROR.TITLE"),description:a("APPS.AMBULANCE.CHAT.ERROR.FAILED_KICK",{name:S==null?void 0:S.name}),buttons:[{title:a("APPS.AMBULANCE.OK")}]});v("info","successfully kicked user"),M.PopUp.set({title:a("APPS.AMBULANCE.CHAT.SUCCESS.TITLE"),description:a("APPS.AMBULANCE.CHAT.SUCCESS.KICKED",{name:S==null?void 0:S.name}),buttons:[{title:a("APPS.AMBULANCE.OK")}]})})}}]})}}))})},100)})}}];M.ContextMenu.set({title:a("APPS.AMBULANCE.CHAT.MANAGE"),buttons:s.filter(Boolean)})},children:a("APPS.AMBULANCE.CHAT.MANAGE")}),t("div",{className:"button red",onClick:()=>{M.PopUp.set({title:a("APPS.AMBULANCE.CHAT.LEAVE.TITLE"),description:a("APPS.AMBULANCE.CHAT.LEAVE.DESCRIPTION"),buttons:[{title:a("APPS.AMBULANCE.CANCEL")},{title:a("APPS.AMBULANCE.CHAT.LEAVE.TITLE"),color:"red",cb:()=>{O("Ambulance",{action:"leaveChat",id:i.id},!0).then(s=>{var l,d,S;if(!s)return M.PopUp.set({title:a("APPS.AMBULANCE.CHAT.ERROR.TITLE"),description:a("APPS.AMBULANCE.CHAT.ERROR.FAILED_LEAVE"),buttons:[{title:a("APPS.AMBULANCE.OK")}]});q.reset(),B.set((l=B.value)==null?void 0:l.filter(f=>f.id!==i.id)),h.APPS.AMBULANCE.chatrooms.set((S=(d=h.APPS.AMBULANCE.chatrooms)==null?void 0:d.value)==null?void 0:S.filter(f=>f.id!==i.id))})}}]})},children:a("APPS.AMBULANCE.CHAT.LEAVE.TITLE")})]})]}),t("div",{className:"items",children:n("div",{className:"chat-container",children:[t("div",{className:"chat-body",onScroll:E,children:t("div",{className:"message-body",children:u.map((s,l)=>t(qt,{index:l,messages:u,message:s},s.id))})}),t("div",{className:"attachments",children:N.attachments.map((s,l)=>n("div",{className:"attachment",children:[$e(s)?t("video",{src:s,muted:!0,controls:!1,loop:!0,autoPlay:!0}):t("img",{src:s}),t(qe,{onClick:()=>{L({...N,attachments:N.attachments.filter((d,S)=>S!==l)})}})]},l))}),n("div",{className:"chat-footer",children:[t(Ye,{ref:o,type:"text",placeholder:a("APPS.AMBULANCE.CHAT.PLACEHOLDER"),onChange:s=>{L({...N,content:s.target.value})},onKeyDown:s=>{s.key==="Enter"&&g()}}),t("div",{className:"button",onClick:()=>{M.Gallery.set({multiSelect:!0,includeVideos:!0,onSelect:s=>{let l=(s==null?void 0:s.length)>0?s:[s];L({...N,attachments:[...N.attachments,...l==null?void 0:l.map(d=>d.src)]})}})},children:t(ct,{})}),t("div",{className:"button",onClick:g,children:t(ot,{})})]})]})})]})},i==null?void 0:i.id)},qt=({messages:e,message:i,index:c})=>{var R,w,N,L,o,g,E,s;const r=T(Z),m=r==null?void 0:r.id;let u=c===0?"last":"",A=((R=i.sender)==null?void 0:R.id)===m?"self":"other",p=!e[c-1]||((w=e[c-1].sender)==null?void 0:w.id)!==((N=i.sender)==null?void 0:N.id),P=((o=(L=e[c+1])==null?void 0:L.sender)==null?void 0:o.id)===m?"self":"other",U;return e[c+1]?U=Math.abs(i.timestamp-e[c+1].timestamp)/36e5:P=void 0,t("div",{id:u,className:z("message",((g=i.sender)==null?void 0:g.id)===m?"self":"other"),children:n("div",{className:"has-avatar",children:[A=="other"&&t("img",{className:"avatar","data-show":p,src:W(i.sender.avatar)}),n("div",{className:"message-content",children:[p&&A=="other"&&t("div",{className:"user",children:(E=i.sender)==null?void 0:E.name}),i.content&&t("div",{className:"content",children:i.content}),i.attachments&&((s=i.attachments)==null?void 0:s.length)>0&&t("div",{className:"attatchments",children:i.attachments.map((l,d)=>$e(l)?t("video",{src:l,controls:!1,loop:!0,autoPlay:!0,muted:!0,onClick:S=>M.FullscreenImage.set(l)},d):t("img",{src:l,onClick:()=>M.FullscreenImage.set(l)},d))}),e[c+1]&&U>6?t("div",{className:"date",children:Te(i.timestamp)}):A!==P&&t("div",{className:"date",children:Te(i.timestamp)})]})]})},c)},Yt=Object.freeze(Object.defineProperty({__proto__:null,UnreadChatMessages:Ae,default:Kt},Symbol.toStringTag,{value:"Module"})),le=G([]).mock(j.dispatch.alarms),Ie=G([]).mock(j.dispatch.employees),Ee=G(null),$=G({showAlarms:!0,showEmployees:!0}),Qe=G({}),Wt=G({});function Zt(){const e=T($),i=T(he),c=T(Ie),r=T(le),m=T(Qe),u=T(Ee),[A,p]=C.useState([0,2]),P={high:{color:"red",label:a("APPS.AMBULANCE.DISPATCH.PRIORITY.HIGH")},medium:{color:"yellow",label:a("APPS.AMBULANCE.DISPATCH.PRIORITY.MEDIUM")},low:{color:"green",label:a("APPS.AMBULANCE.DISPATCH.PRIORITY.LOW")}};C.useEffect(()=>{if((window==null?void 0:window.chrome)!==void 0){const N=ee.GridLayer.prototype._initTile;ee.GridLayer.include({_initTile:function(L){N.call(this,L);const o=this.getTileSize();L.style.width=`${o.x+1}px`,L.style.height=`${o.y+1}px`}})}return O("Maps",{action:"toggleUpdateCoords",toggle:!0}),()=>{O("Maps",{action:"toggleUpdateCoords",toggle:!1})}},[]),C.useEffect(()=>{oe("Ambulance")||O("Maps",{action:"toggleUpdateCoords",toggle:!1})},[i==null?void 0:i.active]),H("maps:updateCoords",N=>{var L,o;if(N){if((o=(L=de)==null?void 0:L.value)!=null&&o.airplaneMode)return v("info","Airplane mode is enabled, can't update coords");p([N.y,N.x])}}),H("dispatch:dispatch:remove",N=>{le.set(le.value.filter(L=>L.id!==N))}),H("ambulance:updateEmployeeBlips",N=>{var L,o;if(!N)return v("error","No data received for ambulance:updateOfficerBlips");if((o=(L=de)==null?void 0:L.value)!=null&&o.airplaneMode)return v("info","Airplane mode is enabled, can't update coords");Ie.set(N)});const U=new ee.Icon({iconUrl:"./assets/img/icons/police/pin.svg",popupAnchor:[-0,-0],iconSize:[30,30]}),w=((N,L,o)=>ee.divIcon({html:`<div style="
            background-color: ${N};
            opacity: 0.8;
            width: ${L}px;
            height: ${L}px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.8);
            box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.1);
            zIndex: 999;
          "></div>`,className:o,iconSize:[L,L],iconAnchor:[L/2,L/2]}))("rgba(250,0,0,0.7)",60,"alarm-marker");return C.useEffect(()=>{if(!u)return;if(!r.find(L=>L.id===u))return v("error","Alarm not found, cannot mark it?");setTimeout(()=>{Ee.set(null)},100)},[u]),t(_.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:t("main",{className:"main dispatch",children:t("div",{className:"map-wrapper",children:n(dt,{className:"map",crs:ci,center:[0,0],zoom:3,minZoom:3,maxZoom:6,bounceAtZoomLimits:!0,maxBoundsViscosity:.95,maxBounds:[[9e3,-5700],[-4500,6500]],preferCanvas:!0,boxZoom:!1,children:[n("div",{className:"right-panel",children:[t(Xt,{}),c.length>0&&t(Qt,{}),r.filter(N=>N.job==="ambulance").length>0&&t(ti,{})]}),e.showAlarms&&r.filter(N=>N.job==="ambulance").map((N,L)=>{var o;return t(ge,{position:[N.location.coords.y,N.location.coords.x],icon:w,children:t(ke,{className:"alarm-popup",children:n("div",{className:"dispatch-wrapper","data-small":"true",children:[n("div",{className:"dispatch-header",children:[n("div",{className:"buttons",children:[t("div",{"data-color":P[N.priority].color,children:P[N.priority].label}),t("div",{"data-color":"yellow",children:N.code})]}),t("div",{children:t("div",{className:"timestamp",children:Te(N.timestamp)})})]}),n("div",{className:"dispatch-content",children:[n("div",{className:"dispatch-info",children:[t("div",{className:"title",children:N.title}),t("div",{className:"description",children:N.description}),t(se,{children:n("div",{className:"fields",children:[n("div",{className:"field",children:[t(At,{}),N.location.label]}),(o=N==null?void 0:N.fields)==null?void 0:o.map((g,E)=>{var s,l;return n("div",{className:"field",children:[g.icon&&((s=g.icon)!=null&&s.includes("fa")?ut(g.icon):((l=Ge)==null?void 0:l[g.icon])&&Ge[g.icon]()),t("div",{className:"field-label",children:g.label}),g.value&&t("span",{children:" - "}),g.value&&t("span",{children:g.value})]})})]})})]}),N.image&&t(_.img,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,ease:"easeOut"},src:N.image}),t("div",{className:"dispatch-controls"}),t("div",{className:"button",onClick:()=>{O("Dispatch",{action:"respondDispatch",id:N.id})},children:a("APPS.AMBULANCE.DISPATCH.RESPOND")})]})]})})},L)}),e.showEmployees&&c.map((N,L)=>t(ge,{ref:m[N.source],position:[N.coords.y,N.coords.x],icon:ai(N.inVehicle),children:t(ke,{className:"alarm-popup",children:t("div",{className:"officer-wrapper","data-small":"true",children:n("div",{className:"officer-content",children:[n("div",{className:"officer-user",children:[t("img",{src:W(N.avatar,"dark")}),n("div",{className:"officer-info",children:[t("div",{className:"name",children:N.name}),N.callsign&&t("div",{className:"callsign",children:N.callsign})]})]}),t("div",{className:"button",onClick:()=>{O("Maps",{action:"setWaypoint",coords:{x:N.coords.x,y:N.coords.y}})},children:a("APPS.AMBULANCE.DISPATCH.SET_WAYPOINT")})]})})})},L)),!A.includes(0,1)&&t(ge,{position:A,icon:U}),t(mt,{url:"https://loaf-scripts.com/fivem/lb-phone/map/satellite/{z}/{x}/{y}.png"})]})})})})}const Xt=()=>{let e=[{label:"Toggle Employees",value:$==null?void 0:$.value.showEmployees,onChange:i=>{$.patch({showEmployees:!$.value.showEmployees})}},{label:"Toggle Alarms",value:$==null?void 0:$.value.showAlarms,onChange:i=>{$.patch({showAlarms:!$.value.showAlarms})}}];return t("div",{className:"options",onClick:i=>i.stopPropagation(),children:e.map((i,c)=>n("div",{className:"option",children:[t(Pt,{checked:i.value,onChange:i.onChange})," ",i.label]},c))})},Qt=()=>{const[e,i]=C.useState(!1),c=T(Ie),r=C.useRef(null),m=T(Qe);return n("div",{className:"expandable-list",children:[t(()=>{const A=We();return r.current=A,null},{}),t(se,{children:n(_.div,{initial:{opacity:0,right:0},animate:{right:e?0:-50,opacity:e?1:0},exit:{opacity:0,right:0},transition:{ease:"easeInOut",duration:.2},className:"content",children:[t("div",{className:"title",children:a("APPS.AMBULANCE.DISPATCH.EMPLOYEES")}),t("div",{className:"items",children:c.map((A,p)=>n("div",{className:"item",onClick:()=>{if(!(r!=null&&r.current))return v("error","Map ref not found");if(!A.coords)return v("error","Officer has no coords");r.current.setView([A.coords.y,A.coords.x],5,{animate:!0,duration:.5}),setTimeout(()=>{const P=m[A.source];P&&P.current&&P.current.openPopup()},150)},children:[t("img",{src:W(A.avatar)}),n("div",{className:"info",children:[t("div",{className:"title",children:A.name}),t("div",{className:"card orange",children:A.callsign})]})]},p))})]})}),t(_.div,{className:"collapse",onClick:()=>i(!e),animate:{rotate:e?0:180,left:e?"-0.675rem":"inherit",right:e?"inherit":"-0.5rem"},children:t(ye,{})})]})},ei={high:"red",medium:"orange",low:"green"},ti=()=>{const[e,i]=C.useState(!1),c=T(le),r=C.useRef(null),m=T(Wt);return n("div",{className:"expandable-list",children:[t(()=>{const A=We();return r.current=A,null},{}),t(se,{children:n(_.div,{initial:{opacity:0,right:0},animate:{right:e?0:-50,opacity:e?1:0},exit:{opacity:0,right:0},transition:{ease:"easeInOut",duration:.2},className:"content",children:[t("div",{className:"title",children:a("APPS.AMBULANCE.DISPATCH.ALARMS")}),t("div",{className:"items",children:c.filter(A=>A.job==="ambulance").map((A,p)=>t("div",{className:"item",onClick:()=>{if(!(r!=null&&r.current))return v("error","Map ref not found");if(!A.location.coords)return v("error","Employee has no coords");r.current.setView([A.location.coords.y,A.location.coords.x],5,{animate:!0,duration:.5}),setTimeout(()=>{const P=m[A.id];P&&P.current&&P.current.openPopup()},150)},children:n("div",{className:"info",children:[n("div",{className:"info-header",children:[t("div",{className:z("card",ei[A.priority]),children:A.code}),t("div",{className:"title",children:A.title})]}),t("div",{className:"subtitle",children:A.description.substring(0,50)})]})},p))})]})}),t(_.div,{className:"collapse",onClick:()=>i(!e),animate:{rotate:e?0:180,left:e?"-0.675rem":"inherit",right:e?"inherit":"-0.5rem"},children:t(ye,{})})]})},ii=(e,i)=>new ee.Icon({iconUrl:e??"./assets/img/icons/maps/mappin.png",popupAnchor:[-0,-0],iconSize:i}),ai=e=>ii(e?"./assets/img/icons/ambulance/car.svg":"./assets/img/icons/ambulance/person.svg",[30,30]),si=117.3,ni=172.8,ri=.02072,li=.0205,ci=ee.extend({},ee.CRS.Simple,{projection:ee.Projection.LonLat,scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/.6931471805599453},distance:function(e,i){var c=i.lng-e.lng,r=i.lat-e.lat;return Math.sqrt(c*c+r*r)},transformation:new ee.Transformation(ri,si,-li,ni),infinite:!0}),oi=Object.freeze(Object.defineProperty({__proto__:null,Alarms:le,SelectedDispatch:Ee,default:Zt},Symbol.toStringTag,{value:"Module"}));function di(){var A;const e=T(ne);T(le);const i=T(h.APPS.AMBULANCE.permissions),[c,r]=C.useState(!1),m={chat:T(Ae),dispatch:(A=T(le))==null?void 0:A.filter(p=>p.job==="ambulance").length},u=[{icon:t(Nt,{}),title:a("APPS.AMBULANCE.HOME.TITLE"),value:"home",activeIcon:t(ht,{})},{icon:t(Ct,{}),title:a("APPS.AMBULANCE.DISPATCH.TITLE"),value:"dispatch",activeIcon:t(vt,{})},{icon:t(Et,{}),title:a("APPS.AMBULANCE.JOURNALS.TITLE"),value:"profiles",activeIcon:t(pt,{})},{icon:t(St,{}),title:a("APPS.AMBULANCE.REPORTS.TITLE"),value:"reports",activeIcon:t(ft,{})},{icon:t(gt,{}),title:a("APPS.AMBULANCE.CONDITIONS.TITLE"),value:"conditions",activeIcon:t(Lt,{})},{icon:t(Tt,{}),title:a("APPS.AMBULANCE.EMPLOYEES.TITLE"),value:"employees",activeIcon:t(It,{})},{icon:t(Ot,{}),title:a("APPS.AMBULANCE.CHAT.TITLE"),value:"chat",activeIcon:t(bt,{})},{icon:t(yt,{}),title:a("APPS.POLICE.LOGS.TITLE"),value:"logs",activeIcon:t(Mt,{})}];return C.useEffect(()=>{oe("Ambulance")&&O("Ambulance",{action:"getUnreadChats"},2).then(p=>{p&&Ae.set(p)})},[]),n("div",{className:"ambulance-sidebar","data-collapsed":c,style:{width:c?"7%":"20%"},children:[t("div",{className:"collapse",onClick:()=>r(!c),children:c?t(ye,{}):t(Ut,{})}),t("div",{className:"items",children:u.filter(p=>{var P;return((P=i==null?void 0:i[p.value])==null?void 0:P.view)!==!1}).map((p,P)=>{let U=e===p.value;return n("div",{className:"item","data-active":U,"data-disabled":p.disabled,onClick:()=>{p.disabled||ne.set(p.value)},children:[U?p.activeIcon:p.icon,!c&&t("div",{className:"title",children:p.title}),m[p.value]>0&&t("div",{className:"notifications",children:m==null?void 0:m[p.value]}),p.disabled&&!c&&t("div",{className:"soon",children:a("APPS.POLICE.MISC.SOON")})]},P)})})]})}const Y=G([]),y=G(null);function Ai(){var g;const e=T(Y),i=T(y),c=T(h.APPS.AMBULANCE.permissions),[r,m]=C.useState(""),[u,A]=C.useState(""),[p,P]=C.useState(0),[U,R]=C.useState(!1),[w,N]=C.useState(!1);C.useEffect(()=>{const E=setTimeout(()=>m(u),500);return()=>clearTimeout(E)},[u]),C.useEffect(()=>{P(0),R(!1),O("Ambulance",{action:"getReports",query:r,page:0},j.reports.filter(E=>E.title.toLowerCase().includes(r.toLowerCase())||E.description.toLowerCase().includes(r.toLowerCase()))).then(E=>{if(!E)return v("error","Failed to fetch reports");Y.set(E)})},[r]);const L=E=>{if(U||w)return;let s=document.querySelector("#last");if(!s)return;!me(s)&&(N(!0),O("Ambulance",{action:"getReports",query:r,page:p+1},null).then(d=>{d&&d.length>0?(Y.set([...e,...d]),N(!1),d.length<10&&R(!0)):R(!0)}),P(d=>d+1))},o=E=>{E&&O("Ambulance",{action:"getReport",id:E},j.reports.find(s=>s.id===E)).then(s=>{if(!s)return v("error","Failed to fetch report");y.set(s)})};return H("ambulance:reportDeleted",E=>{var s;if(!E)return v("error","No id provided in reportDeleted event");Y.set(Y.value.filter(l=>l.id!==E)),((s=y.value)==null?void 0:s.id)===E&&y.reset()}),t(_.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:i?t(se,{children:t(ui,{})}):t("main",{className:"main",children:n("div",{className:"page",children:[n("div",{className:"top",children:[t("div",{className:"title",children:a("APPS.AMBULANCE.REPORTS.TITLE")}),((g=c==null?void 0:c.report)==null?void 0:g.create)&&n("div",{className:"button",onClick:()=>y.set({}),children:[t(J,{}),a("APPS.AMBULANCE.CREATE")]})]}),t(ue,{placeholder:a("APPS.AMBULANCE.REPORTS.SEARCH"),onChange:E=>A(E.target.value)}),n("div",{className:"items",onScroll:L,children:[e.length===0&&r.length==0&&t("div",{className:"no-results",children:a("APPS.AMBULANCE.SEARCH_FOR",{query:a("APPS.AMBULANCE.REPORTS.REPORT").toLowerCase()})}),e.length===0&&r.length>0&&t("div",{className:"no-results",children:a("APPS.AMBULANCE.NO_RESULTS_FOR",{query:r})}),e==null?void 0:e.map((E,s)=>{var d,S;let l=s===e.length-1?"last":"";return n(_.div,{...re,id:l,className:"item incident",onClick:()=>o(E.id),children:[t("div",{className:"name",children:E.title}),n("div",{className:"subtitle",children:[E.type," - ",(d=E.description)==null?void 0:d.substring(0,200),"..."]}),t("div",{className:"cards",children:(S=E.tags)==null?void 0:S.map((f,k)=>t("div",{className:z("card",f.color),children:f.title},k))}),n("div",{className:"id report",style:{marginTop:"auto"},children:[t("div",{className:"label",children:a("APPS.AMBULANCE.REPORTS.FOOTER",{author:E.author,id:E.id})}),t("div",{className:"value",children:it(E.lastUpdated)})]})]},s)})]})]})})})}const ui=()=>{var U,R,w,N,L,o,g,E,s,l,d,S,f,k,V,Ne,Re,Be,De;const e=T(y),i=T(ce),c=T(h.APPS.AMBULANCE.permissions),[r,m]=C.useState(!(e!=null&&e.id)),u=C.useRef(!1);C.useEffect(()=>{var I,D,F,x,X;(I=y.value)!=null&&I.id||y.set({title:a("APPS.AMBULANCE.REPORTS.NEW_REPORT_TITLE"),description:(F=(D=i==null?void 0:i.Ambulance)==null?void 0:D.Templates)==null?void 0:F.Report,type:(X=(x=i==null?void 0:i.Ambulance)==null?void 0:x.ReportTypes)==null?void 0:X[0]})},[]);const A=()=>{var I,D,F,x,X,_e;if(!(e!=null&&e.title)||((I=e==null?void 0:e.title)==null?void 0:I.length)<3)return M.PopUp.set({title:a("APPS.AMBULANCE.REPORTS.ERROR.TITLE"),description:a("APPS.AMBULANCE.REPORTS.ERROR.TITLE_LENGTH"),buttons:[{title:a("APPS.AMBULANCE.CANCEL")}]});if(!(e!=null&&e.type))return M.PopUp.set({title:a("APPS.AMBULANCE.REPORTS.ERROR.TITLE"),description:a("APPS.AMBULANCE.REPORTS.ERROR.NO_TYPE"),buttons:[{title:a("APPS.AMBULANCE.CANCEL")}]});if(!(e!=null&&e.description)||((D=e==null?void 0:e.description)==null?void 0:D.length)<10)return M.PopUp.set({title:a("APPS.AMBULANCE.REPORTS.ERROR.TITLE"),description:a("APPS.AMBULANCE.REPORTS.ERROR.DESCRIPTION_LENGTH"),buttons:[{title:a("APPS.AMBULANCE.CANCEL")}]});if(!u.current){v("info","No edits made, not saving report"),y.reset();return}O("Ambulance",{action:"saveReport",data:{id:e.id,title:e.title,description:e.description,type:e.type,gallery:e.gallery,doctors:(F=e.doctorsInvolved)==null?void 0:F.map(Q=>Q.id),patient:(x=e.patient)==null?void 0:x.id,injuries:(X=e.injuries)==null?void 0:X.map(Q=>Q.id),tags:(_e=e.tags)==null?void 0:_e.map(Q=>Q.id)}},e.id?e.id:Math.random().toString(36).substring(7)).then(Q=>{var we;if(!Q)return v("error","Failed to save report");e.id?Y.set(Y.value.map(He=>{var Ve;return He.id===Q?{...e,lastUpdated:Date.now(),author:(Ve=Z.value)==null?void 0:Ve.name}:He})):Y.set([{...e,id:Q,lastUpdated:Date.now(),author:(we=Z.value)==null?void 0:we.name},...Y.value]),y.reset()})},p=()=>{O("Ambulance",{action:"deleteReport",id:e.id}).then(I=>{if(!I)return v("error","Failed to delete report");Y.set(Y.value.filter(D=>D.id!==e.id)),y.reset()})};let P=C.useRef(!0);return C.useEffect(()=>{if(e){if(P.current){P.current=!1;return}u.current=!0}},[e]),H("ambulance:tagAdded",I=>{const{type:D,id:F,tagId:x}=I;D==="report"&&F===e.id&&y.set({...y.value,tags:[...e.tags??[],h.APPS.AMBULANCE.tags.value.find(X=>X.id===x)]})}),H("ambulance:tagRemoved",I=>{const{type:D,id:F,tagId:x}=I;D==="report"&&F===e.id&&y.set({...y.value,tags:[...e.tags.filter(X=>X.id!==x)]})}),n(_.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{ease:"easeInOut",duration:.25},className:"grid-container",children:[n("div",{className:"grid-header",children:[n("div",{className:"back",onClick:()=>y.reset(),children:[t(Je,{})," ",a("APPS.AMBULANCE.BACK")]}),t("div",{className:"title",children:t(Ye,{type:"text",defaultValue:e.title??a("APPS.AMBULANCE.REPORTS.NEW_REPORT_TITLE"),disabled:!r,style:{width:(e.title??a("APPS.AMBULANCE.REPORTS.NEW_REPORT_TITLE")).length+2+"ch"},onChange:I=>{I.target.value.length<25&&(I.target.style.width=I.target.value.length+2+"ch"),y.set({...y.value,title:I.target.value})}})}),n("div",{className:"buttons",children:[((U=c==null?void 0:c.report)==null?void 0:U.delete)&&!r&&e.id&&t("div",{className:"button red",onClick:p,children:a("APPS.AMBULANCE.DELETE")}),r&&t("div",{className:"button red",onClick:()=>{e.id?m(!1):y.reset()},children:a("APPS.AMBULANCE.CANCEL")}),((R=c==null?void 0:c.report)==null?void 0:R.edit)&&t("div",{className:"button",onClick:()=>{r?A():m(!0)},children:r?a("APPS.AMBULANCE.SAVE"):a("APPS.AMBULANCE.EDIT")})]})]}),n("div",{className:"grid-body",style:{gridTemplateAreas:`
                        'patient type'
                        'patient tags'
                        'description gallery'
                        'description injuries'
                        'description doctorsInvolved'
                        `},children:[n("div",{className:"grid-item",style:{gridArea:"patient"},children:[n("div",{className:"top",children:[t("div",{className:"title",children:"Patient"}),r&&n(_.div,{...ae,className:z("button",e.patient&&"red"),onClick:()=>{e.patient?y.set({...y.value,patient:null}):K.set({type:"profiles",onSelect:I=>{y.set({...y.value,patient:I})}})},children:[!e.patient&&t(J,{}),e.patient?a("APPS.AMBULANCE.REMOVE"):a("APPS.AMBULANCE.ADD")]})]}),t("div",{className:"items",children:t("div",{className:"item profile",children:n("div",{className:"left",style:{borderRight:"inherit"},children:[t("div",{className:"mugshot",children:t("img",{"data-hasavatar":!!((w=e==null?void 0:e.patient)!=null&&w.avatar),src:W((N=e==null?void 0:e.patient)==null?void 0:N.avatar),onClick:()=>{var I,D;(I=e==null?void 0:e.patient)!=null&&I.avatar&&M.FullscreenImage.set((D=e==null?void 0:e.patient)==null?void 0:D.avatar)}})}),n("div",{className:"info",children:[t("div",{className:"name",children:((L=e==null?void 0:e.patient)==null?void 0:L.name)??a("APPS.AMBULANCE.REPORTS.ADD_PATIENT")}),(e==null?void 0:e.patient)&&n("div",{className:"job",children:[(o=e==null?void 0:e.patient)==null?void 0:o.dob," (",Se((g=e==null?void 0:e.patient)==null?void 0:g.dob),")"]})]})]})})})]}),n("div",{className:"grid-item",style:{gridArea:"type"},children:[t("div",{className:"top",children:t("div",{className:"title",children:a("APPS.AMBULANCE.REPORTS.TYPE")})}),t("div",{className:"items",children:t("select",{disabled:!r,value:e.type,onChange:I=>y.set({...y.value,type:I.target.value}),children:(s=(E=i==null?void 0:i.Ambulance)==null?void 0:E.ReportTypes)==null?void 0:s.map((I,D)=>t("option",{selected:e.type===I,children:I},D))})})]}),n("div",{className:"grid-item",style:{gridArea:"description"},children:[t("div",{className:"top",children:t("div",{className:"title",children:a("APPS.AMBULANCE.REPORTS.DESCRIPTION")})}),t("div",{className:"items",children:t(ze,{className:"note",placeholder:a("APPS.AMBULANCE.REPORTS.DESCRIPTION_PLACEHOLDER"),defaultValue:e.description??((d=(l=i==null?void 0:i.Police)==null?void 0:l.Templates)==null?void 0:d.Report),disabled:!r,onChange:I=>y.set({...y.value,description:I.target.value}),style:{height:"20rem"}})})]}),n("div",{className:"grid-item",style:{gridArea:"tags"},children:[n("div",{className:"top",children:[t("div",{className:"title",children:a("APPS.POLICE.TAGS.TITLE")}),r&&n(_.div,{...ae,className:"button",onClick:()=>{Ze("report",e==null?void 0:e.id,!1,I=>y.set({...y.value,tags:[...e.tags??[],I]}))},children:[t(J,{}),a("APPS.POLICE.TAGS.ADD")]})]}),n("div",{className:"items",children:[(!(e!=null&&e.tags)||((S=e==null?void 0:e.tags)==null?void 0:S.length)===0)&&t("div",{className:"no-results",children:a("APPS.POLICE.TAGS.NO_TAGS")}),t("div",{className:"cards",children:(f=e==null?void 0:e.tags)==null?void 0:f.map((I,D)=>t(Ue,{tag:I,editMode:r,cb:()=>{y.set({...y==null?void 0:y.value,tags:e.tags.filter(F=>F.id!==I.id)})}},D))})]})]}),n("div",{className:"grid-item",style:{gridArea:"gallery",alignSelf:"start"},children:[n("div",{className:"top",children:[t("div",{className:"title",children:a("APPS.AMBULANCE.REPORTS.GALLERY")}),r&&n(_.div,{...ae,className:"button",onClick:()=>{M.Gallery.set({onSelect:I=>{y.set({...y.value,gallery:[...e.gallery??[],I.src]})}})},children:[t(J,{}),a("APPS.AMBULANCE.ADD")]})]}),n("div",{className:"items",children:[(!(e!=null&&e.gallery)||((k=e==null?void 0:e.gallery)==null?void 0:k.length)===0)&&t("div",{className:"no-results",children:a("APPS.AMBULANCE.REPORTS.NO_ATTACHMENTS")}),t("div",{className:"images",children:(V=e==null?void 0:e.gallery)==null?void 0:V.map((I,D)=>n("div",{className:"image",children:[t("img",{src:I,onClick:()=>M.FullscreenImage.set(I)}),r&&t(qe,{onClick:()=>{y.set({...y.value,gallery:e.gallery.filter((F,x)=>x!==D)})}})]},D))})]})]}),n("div",{className:"grid-item",style:{gridArea:"injuries"},children:[n("div",{className:"top",children:[t("div",{className:"title",children:a("APPS.AMBULANCE.REPORTS.INJURIES_CONDITIONS")}),r&&n(_.div,{...ae,className:"button",onClick:()=>{K.set({type:"conditions",onSelect:I=>{y.set({...y.value,injuries:[...e.injuries??[],{id:I.id,title:I.title,severity:I.severity}]})}})},children:[t(J,{}),a("APPS.AMBULANCE.ADD")]})]}),n("div",{className:"items",children:[(!e.injuries||((Ne=e.injuries)==null?void 0:Ne.length)===0)&&t("div",{className:"no-results",children:a("APPS.AMBULANCE.REPORTS.NO_INJURIES")}),t("div",{className:"cards",children:(Re=e.injuries)==null?void 0:Re.map((I,D)=>t("div",{className:z("card",Pe(I.severity),r&&"clickable"),onClick:()=>{r&&M.PopUp.set({title:a("APPS.AMBULANCE.REPORTS.REMOVE_INJURY.TITLE"),description:a("APPS.AMBULANCE.REPORTS.REMOVE_INJURY.DESCRIPTION",{name:I.title}),buttons:[{title:a("APPS.AMBULANCE.CANCEL")},{title:a("APPS.AMBULANCE.REMOVE"),color:"red",cb:()=>{y.set({...y.value,injuries:e.injuries.filter((F,x)=>x!==D)})}}]})},children:I.title},D))})]})]}),n("div",{className:"grid-item",style:{gridArea:"doctorsInvolved"},children:[n("div",{className:"top",children:[t("div",{className:"title",children:a("APPS.AMBULANCE.REPORTS.DOCTORS_INVOLVED")}),r&&n(_.div,{...ae,className:"button",onClick:()=>{var I;K.set({type:"profiles",filter:"doctorOnly",exclude:(I=e==null?void 0:e.doctorsInvolved)==null?void 0:I.map(D=>D.id),onSelect:D=>{y.set({...y.value,doctorsInvolved:[...e.doctorsInvolved??[],D]})}})},children:[t(J,{}),a("APPS.AMBULANCE.ADD")]})]}),n("div",{className:"items",children:[(!e.doctorsInvolved||((Be=e.doctorsInvolved)==null?void 0:Be.length)===0)&&t("div",{className:"no-results",children:a("APPS.AMBULANCE.REPORTS.NO_DOCTORS_INVOLVED")}),t("div",{className:"cards",children:(De=e.doctorsInvolved)==null?void 0:De.map((I,D)=>t("div",{className:z("card blue",r&&"clickable"),onClick:()=>{r&&M.PopUp.set({title:a("APPS.AMBULANCE.REPORTS.REMOVE_DOCTOR.TITLE"),description:a("APPS.AMBULANCE.REPORTS.REMOVE_DOCTOR.DESCRIPTION",{name:I.name}),buttons:[{title:a("APPS.AMBULANCE.CANCEL")},{title:a("APPS.AMBULANCE.REMOVE"),color:"red",cb:()=>{y.set({...y.value,doctorsInvolved:e.doctorsInvolved.filter((F,x)=>x!==D)})}}]})},children:I.name},D))})]})]})]})]})},mi=Object.freeze(Object.defineProperty({__proto__:null,ActiveReport:y,default:Ai},Symbol.toStringTag,{value:"Module"})),Pi=C.createContext(null),ne=G("home"),Z=G(null),K=G(null),et=["Green","Red","Yellow","Orange","Blue","Brown","Navy","Cyan","Purple"],Ni={home:C.lazy(()=>te(()=>import("./Home-BNhu86hm.js"),__vite__mapDeps([0,1,2]))),dispatch:C.lazy(()=>te(()=>Promise.resolve().then(()=>oi),void 0)),profiles:C.lazy(()=>te(()=>Promise.resolve().then(()=>Vt),void 0)),reports:C.lazy(()=>te(()=>Promise.resolve().then(()=>mi),void 0)),chat:C.lazy(()=>te(()=>Promise.resolve().then(()=>Yt),void 0)),conditions:C.lazy(()=>te(()=>Promise.resolve().then(()=>_t),void 0)),employees:C.lazy(()=>te(()=>import("./Employees-BbNChSej.js"),__vite__mapDeps([3,1,2]))),logs:C.lazy(()=>te(()=>import("./Logs-tY7T5eIy.js"),__vite__mapDeps([4,1,2])))};function hi(){var A,p;const e=T(ne),i=T(de),c=T(Ce),r=T(K),m=T(he),u=(p=(A=T(he))==null?void 0:A.active)==null?void 0:p.data;return H("ambulance:updatePermissions",P=>h.APPS.AMBULANCE.permissions.set(P)),H("ambulance:tagCreated",P=>h.APPS.AMBULANCE.tags.set([...h.APPS.AMBULANCE.tags.value,P])),H("ambulance:tagDeleted",P=>h.APPS.AMBULANCE.tags.set(h.APPS.AMBULANCE.tags.value.filter(U=>P!==U.id))),H("ambulance:addConditionCategory",P=>{h.APPS.AMBULANCE.conditions.set({...h.APPS.AMBULANCE.conditions.value,[P]:[]})}),H("ambulance:deleteConditionCategory",P=>{const U={...h.APPS.AMBULANCE.conditions.value};delete U[P],h.APPS.AMBULANCE.conditions.set(U)}),H("ambulance:addCondition",P=>{var U;P&&(v("info","Adding condition to category",P),h.APPS.AMBULANCE.conditions.set({...h.APPS.AMBULANCE.conditions.value,[P==null?void 0:P.category]:[...((U=h.APPS.AMBULANCE.conditions.value)==null?void 0:U[P==null?void 0:P.category])??[],P]}))}),H("ambulance:deleteCondition",P=>{if(!P)return v("warning","No offence id provided to deleteCondition");let U=Object.keys(h.APPS.AMBULANCE.conditions.value).find(R=>h.APPS.AMBULANCE.conditions.value[R].find(w=>w.id===P));if(!U)return v("warning","No category found for condition id",P);h.APPS.AMBULANCE.conditions.set({...h.APPS.AMBULANCE.conditions.value,[U]:h.APPS.AMBULANCE.conditions.value[U].filter(R=>R.id!==P)})}),C.useEffect(()=>{u&&(v("info","Metadata received whilst opening app",u),u.view==="dispatch"&&(Ee.set(u.id),ne.set("dispatch")))},[u]),C.useEffect(()=>{oe("Ambulance")&&(O("Ambulance",{action:"getTags"}).then(P=>{if(!P)return v("info","No tags returned in getTags fetch");h.APPS.AMBULANCE.tags.set(P)}),O("Ambulance",{action:"getUser"},j.user).then(P=>{if(!P)return v("info","No users returned in getUser fetch");Z.set(P)}))},[]),C.useEffect(()=>{oe("Ambulance")&&(h.APPS.AMBULANCE.permissions.value||(O("Ambulance",{action:"getPermissions"},j.permissions).then(P=>{if(!P){v("info","No permissions returned in getPermissions fetch, closign app"),he.patch({active:null});return}h.APPS.AMBULANCE.permissions.set(P)}),O("Ambulance",{action:"getConditions"},j.conditions).then(P=>{if(!P)return v("warning","No conditions returned from server");h.APPS.AMBULANCE.conditions.set(P)})))},[m==null?void 0:m.active]),n("div",{className:"ambulance-container",children:[t(kt,{}),n("main",{children:[t(di,{}),n("div",{className:"main-container",children:[t(se,{children:t("div",{className:"main-wrapper",children:t(C.Suspense,{fallback:t(xt,{theme:i.display.theme}),children:t(Ci,{data:e})})})}),n(se,{children:[r&&t(Jt,{}),c&&t(zt,{})]})]})]})]})}const Ci=({data:e})=>{if(!e)return null;const i=Ni[e];return i?t(i,{}):t("div",{children:"View not found"})},Ue=({tag:e,editMode:i,parentId:c,cb:r})=>{let u=T(ne)==="profiles",A=Oe(()=>{if(i){if(!h.APPS.AMBULANCE.permissions.value.tag.delete)return v("error","User does not have permission to delete tags");Rt(e.id,()=>r==null?void 0:r())}});return t("div",{...A,className:z("card",e==null?void 0:e.color,i&&"clickable"),onClick:()=>{i&&M.PopUp.set({title:a("APPS.POLICE.TAGS.REMOVE_TAG.TITLE"),description:a("APPS.POLICE.TAGS.REMOVE_TAG.DESCRIPTION",{tag:e.title}),buttons:[{title:a("APPS.POLICE.TAGS.REMOVE_TAG.CANCEL")},{title:a("APPS.POLICE.TAGS.REMOVE_TAG.REMOVE"),color:"red",cb:()=>{u?O("Ambulance",{action:"removeTag",data:{id:c,tag:e.id}},!0).then(p=>{if(!p)return v("error","removeTag did not return success");r==null||r()}):r==null||r()}}]})},children:e.title})},vi=e=>{if(!e)return v("error","No identifier provided to fetchProfile");O("Ambulance",{action:"fetchProfile",id:e},j.profiles.find(i=>i.id===e)).then(i=>{if(!i)return v("info","fetchProfile did not return anything");b.set(i),ne.set("profiles")})},tt=e=>{if(!e)return v("error","No id provided to fetchReport");O("Ambulance",{action:"getReport",id:e}).then(i=>{if(!i)return v("info","fetchReport did not return anything");y.set(i),ne.set("reports")})},W=(e,i)=>{var c;return e||`./assets/img/icons/avatar-placeholder-${i??((c=de)==null?void 0:c.value.display.theme)}.svg`},it=e=>{if(!e)return a("APPS.POLICE.MISC.UNKNOWN");const i=new Date(e),c=i.getDate().toString(),r=i.toLocaleString("default",{month:"long"}),m=i.getFullYear().toString(),u=i.getHours().toString().padStart(2,"0"),A=i.getMinutes().toString().padStart(2,"0");return a("APPS.POLICE.MISC.FORMATTED_DATE",{day:c,month:r,year:m,hours:u,minutes:A})};function Ei(){var r,m,u;const e=(u=(m=(r=ce.value)==null?void 0:r.Ambulance)==null?void 0:m.Callsign)==null?void 0:u.Format;if(!e)return null;const c=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/1/g,"\\d").replace(/a/g,"[a-z]").replace(/A/g,"[A-Z]");return new RegExp(`^${c}$`)}const at=e=>Ei().test(e),Si=Object.freeze(Object.defineProperty({__proto__:null,LookupModal:K,PoliceContext:Pi,TagColors:et,TagComponent:Ue,User:Z,View:ne,checkCallsignFormat:at,default:hi,fetchAndSetProfile:vi,fetchAndSetReport:tt,formatDate:it,getAvatar:W},Symbol.toStringTag,{value:"Module"}));export{j as A,Ce as M,b as S,Z as U,ne as V,y as a,Si as b,W as g};
