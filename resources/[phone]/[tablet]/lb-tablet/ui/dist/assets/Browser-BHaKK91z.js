import{a as h,j as o,O as $,r as d,P as J,I as j,L as H,u as S,F as V,Q,G as N,h as Z,R as ee,U as te,f as q,V as O,o as re,W as ne,X as oe,Y as se,Z as ie,_ as ae,K as C,N as ce}from"./index-B-vcvQz_.js";function le({data:e}){return h("div",{className:"bookmark-wrapper",onMouseUp:s=>F(e.url),children:[o(ue,{icon:e==null?void 0:e.icon}),o("div",{className:"title",children:e.title})]})}const ue=({icon:e})=>e?o("img",{src:e}):o($,{});function de({active:e}){const[s,r]=d.useState("");return o("div",{className:"empty-tab","data-active":e,children:h("div",{className:"empty-tab-content",children:[o("img",{className:"logo",src:"./assets/img/logo.png"}),h("div",{className:"searchbar",children:[o(J,{}),o(j,{type:"text",placeholder:H("APPS.BROWSER.SEARCH_PLACEHOLDER"),value:s,onChange:a=>r(a.target.value),onKeyUp:a=>a.key==="Enter"&&F(a.currentTarget.value)})]})]})})}function fe({data:e,active:s,addRef:r}){const a=S(y),[u,b]=d.useState(!1),[v,i]=d.useState(null),p=d.useRef(),E=d.useRef(!0);return d.useEffect(()=>{v&&(p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{v&&X(e.id,v,E.current),E.current&&(E.current=!1)},250))},[v]),d.useEffect(()=>{b(!1)},[e==null?void 0:e.id,a]),h(V,{children:[u&&h("div",{className:"failed-load",children:[o(Q,{}),o("div",{className:"subtitle",children:H("APPS.BROWSER.FAILED_LOAD_PAGE")})]}),o("iframe",{ref:T=>r(T),src:e.url,title:e.title,"data-active":s,onLoad:async T=>{await new Promise(f=>setTimeout(f,100));const A=T.target,c=A.contentDocument;if(!c)return N("warning","Failed to load iframe",e.url);if((c==null?void 0:c.head.childElementCount)===0){N("warning","Failed to load iframe"),b(!0);return}i(f=>{var I;return{...f,title:c.title,icon:(I=c.querySelector("link[rel='icon']"))==null?void 0:I.href}}),c.querySelector("title")&&new MutationObserver(I=>{i(g=>({...g,title:c.title}))}).observe(c.querySelector("title"),{subtree:!0,characterData:!0,childList:!0}),A.contentWindow.navigation.addEventListener("navigate",f=>{i(I=>({...I,url:f.destination.url}))}),c.onmouseup=f=>{if(f.button!==0&&f.button!==1)return;const I=c.elementsFromPoint(f.clientX,f.clientY);for(const g of I)if((g==null?void 0:g.tagName)==="A"&&((g==null?void 0:g.target)==="_blank"||f.button===1)){let x=g.href;f.preventDefault(),P(x)}},A.contentWindow.fetchNui=Z;const R=c.createElement("script");R.innerHTML=`
                    let addedHandlers = [];

                    function refreshInputs(inputs) {
                        inputs.forEach((input) => {
                            if (addedHandlers.includes(input)) return console.log('already added handler for', input);

                            input.addEventListener('focus', () => fetchNui('toggleInput', true, 'ok'));
                            input.addEventListener('blur', () => fetchNui('toggleInput', false, 'ok'));
                        });
                    }

                    refreshInputs(document.querySelectorAll('input, textarea'));

                    const inputObserver = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            mutation.addedNodes.forEach((node) => {
                                if (node.childNodes.length > 0) refreshInputs(node.querySelectorAll('input, textarea'));
                                if (node.tagName === 'INPUT' || node.tagName === 'TEXTAREA') refreshInputs([node]);
                            });
                        });
                    });

                    inputObserver.observe(document.body, { childList: true, subtree: true });
                `,c.body.appendChild(R)}})]})}function me({data:e}){const[s,r]=d.useState(y.value===e.id),a=S(y);return d.useEffect(()=>{r(e.id===y.value)},[a]),h("div",{className:"tab-wrapper","data-active":s,onClick:()=>y.set(e.id),onMouseUp:u=>{u.button===1&&M(e.id)},children:[h("div",{className:"tab-content",children:[o(he,{data:e}),o("div",{className:"title",children:e.title})]}),o(ee,{onClick:u=>{u.stopPropagation(),M(e.id)}})]})}function he({data:e}){return e!=null&&e.icon?o("img",{src:e.icon,onError:s=>{e.id&&X(e.id,{icon:void 0})}}):o($,{})}const m=C([]).mock([{id:"1",title:"LB",url:"https://lbscripts.com"}]),z=localStorage.getItem(`${O.value}-lb-tablet:bookmarks`),ve=z?JSON.parse(z):[],y=C(null).mock("1"),w=C(ve).mock([{id:"1",title:"LB",url:"https://lbscripts.com"},{id:"2",title:"Yep",url:"https://www.yep.com"}]),k=C({}),G=localStorage.getItem(`${O.value}-lb-tablet:browserHistory`),K=C(G?JSON.parse(G):[]);function be(){var g,x;const e=d.useRef([]),s=S(m),r=S(y),a=S(w),u=(g=S(ce))==null?void 0:g.active,[b,v]=d.useState(""),[i,p]=d.useState(!1),[E,T]=d.useState(!1),[A,c]=d.useState(!1),U=t=>{if(t=t??s.find(l=>l.id===r),!(t!=null&&t.url))return;let n=[...w.value,t];w.set(n),localStorage.setItem(`${O.value}-lb-tablet:bookmarks`,JSON.stringify(n)),c(!0)},R=()=>{const t=e.current[r],n=k.value[r];if(!t||!n)return N("warning","No iframe / history found");const l=n.currentIndex;if(l===0)return N("warning","Already at first page");t.src=n.history[l-1],n.currentIndex=l-1,k.patch({[r]:n})},f=()=>{const t=e.current[r],n=k.value[r];if(!t||!n)return N("warning","No iframe / history found");const l=n.currentIndex;if(l===n.history.length-1)return N("warning","Already at last page");t.src=n.history[l+1],n.currentIndex=l+1,k.patch({[r]:n})},I=()=>{var n;const t=e.current[r];t&&((n=t.contentWindow)==null||n.location.reload())};return d.useEffect(()=>{var t;if(te("Browser"))return m.value.length===0&&P(),w.set([...((t=q.value.Browser)==null?void 0:t.DefaultBookmarks)??[],...w.value.filter(n=>{var W,_;let l=!n.id,L=l&&!((_=(W=q.value.Browser)==null?void 0:W.DefaultBookmarks)!=null&&_.find(D=>D.url===n.url)),B=l&&w.value.find(D=>D.url===n.url);return!L&&!B})]),()=>{let n=K.value;localStorage.setItem(`${O.value}-lb-tablet:browserHistory`,JSON.stringify(n))}},[u]),d.useEffect(()=>{var n,l,L;const t=m.value.find(B=>B.id===y.value);t&&(p(((n=k.value[r])==null?void 0:n.currentIndex)!==0),T(((l=k.value[r])==null?void 0:l.currentIndex)!==((L=k.value[r])==null?void 0:L.history.length)-1)),v((t==null?void 0:t.url)??""),c(!!w.value.find(B=>B.url===(t==null?void 0:t.url)))},[r,s]),h("div",{className:"browser-container",children:[h("div",{className:"browser-header",children:[h("div",{className:"tab-container",children:[s.map((t,n)=>o(me,{data:t},n)),o("div",{className:"tab-add",children:o(re,{onClick:()=>P()})})]}),h("div",{className:"search-container",children:[h("div",{className:"actions",children:[o(ne,{"data-disabled":!i,onClick:R}),o(oe,{"data-disabled":!E,onClick:f}),o(se,{"data-disabled":!r,onClick:I})]}),h("div",{className:"searchbar",children:[o(J,{}),o(j,{type:"text",value:b,placeholder:((x=s.find(t=>t.id===r))==null?void 0:x.url)??H("APPS.BROWSER.SEARCH_PLACEHOLDER"),onFocusCapture:t=>t.currentTarget.select(),onKeyUp:t=>{t.key==="Enter"&&F(t.currentTarget.value)},onChange:t=>v(t.currentTarget.value)}),A?o(ie,{className:"bookmark","data-disabled":!r,onClick:()=>{w.set(w.value.filter(t=>t.url!==b)),c(!1)}}):o(ae,{className:"bookmark","data-disabled":!r,onClick:()=>U()})]})]}),o("div",{className:"bookmark-container",children:a.map((t,n)=>o(le,{data:t},n))})]}),o("div",{className:"browser-content",children:s.map((t,n)=>t.url?o(fe,{data:t,active:t.id===r,addRef:l=>e.current[t.id]=l},n):o(de,{active:t.id===r},t.id))})]})}const pe=e=>{if(!e)return N("warning","No data provided to add to long history, returning");K.push({icon:e.icon,title:e.title,link:e.url,date:Date.now()})},F=e=>{e&&(e=Y(e)?e:"https://yep.com/web?q="+encodeURIComponent(e));const s=y.value;m.set([...m.value.map(r=>r.id===s?{...r,url:e}:r)])},P=e=>{e&&(e=Y(e)?e:"https://yep.com/web?q="+encodeURIComponent(e));const s=crypto.randomUUID(),r={id:s,url:e,title:e??"New Tab"};k.patch({[s]:{history:[e],currentIndex:0}}),m.push(r),y.set(s)},M=e=>{var s,r;if(m.value.length===1&&P(),y.value===e){const a=m.value.findIndex(b=>b.id===e),u=((s=m.value[a+1])==null?void 0:s.id)??((r=m.value[a-1])==null?void 0:r.id);y.set(u)}m.set([...m.value.filter(a=>a.id!==e)]),k.patch({[e]:void 0})},X=(e,s,r)=>{let a=r===!0,{title:u,icon:b,link:v}=s;const i=m.value.find(p=>p.id===e);if(i){if(u&&(u.length>20&&(u=u.substring(0,20)+"..."),i&&i.title!==u&&(i.title=u)),b&&(i==null?void 0:i.icon)!==b&&(i.icon=b),v&&(i==null?void 0:i.url)!==v){i.url=v;const p=k.value[e].history;k.patch({[e]:{history:[...p,v],currentIndex:p.length}}),a=!0}a&&pe(i),m.set([...m.value.filter(p=>p.id!==e),i])}},Y=e=>e?new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e):!1;export{y as ActiveTab,w as Bookmarks,K as LongHistory,k as TabHistory,m as Tabs,P as addTab,be as default,M as removeTab,F as setTab,X as updateTabData};
