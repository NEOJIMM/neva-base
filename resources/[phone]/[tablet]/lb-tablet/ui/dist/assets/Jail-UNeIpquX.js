import{u as S,r as E,h,bF as R,G as c,k,j as s,m as b,ac as V,a,L as i,o as U,H as B,bf as G,bD as w,F,bN as D,bH as x,bO as y,K as H,a5 as q,bP as M,g as N,W,a2 as Y,bi as z,bh as $,$ as K,f as Q}from"./index-B-vcvQz_.js";const L=H([]),I=H(null);function ee(){var g;const t=S(L),o=S(I),u=S(K.APPS.POLICE.permissions),[r,O]=E.useState(""),[C,T]=E.useState(""),[_,m]=E.useState(!1),[v,p]=E.useState(!1);E.useEffect(()=>{h("Police",{action:"getJailees",query:r},R.jail.filter(e=>e.name.toLowerCase().includes(r.toLowerCase()))).then(e=>{if(!e)return c("warning","No data received");L.set(e)})},[r]);const f=()=>{if(_||v)return;let e=document.querySelector("#last");if(!e)return;!q(e)&&(p(!0),h("Police",{action:"getJailees",query:r,lastId:t[t.length-1].id},null).then(A=>{A&&A.length>0?(L.set([...t,...A]),p(!1),A.length<10&&m(!0)):m(!0)}))};E.useEffect(()=>{const e=setTimeout(()=>O(C),500);return()=>clearTimeout(e)},[C]);const J=e=>{h("Police",{action:"getJailee",id:e},R.jail.find(d=>d.id===e)).then(d=>{if(!d)return c("warning","No data received");I.set(d)})},l=()=>{let e={};M.set({type:"profiles",filter:"excludeJailed",onSelect:n=>{e.id=n.id,N.PopUp.set({title:i("APPS.POLICE.JAIL.JAIL_PERSON.TITLE"),description:i("APPS.POLICE.JAIL.JAIL_PERSON.DESCRIPTION",{name:n==null?void 0:n.name}),inputs:[{type:"number",placeholder:i("APPS.POLICE.JAIL.JAIL_PERSON.SENTENCE_PLACEHOLDER"),min:"1",onChange:P=>{e.sentence=parseInt(P)}}],textarea:{placeholder:i("APPS.POLICE.JAIL.JAIL_PERSON.REASON_PLACEHOLDER"),maxCharacters:500,onChange:P=>{e.description=P}},buttons:[{title:i("APPS.POLICE.CANCEL")},{title:"Next",cb:()=>d()}]})}});const d=()=>{N.ContextMenu.set({buttons:[{title:i("APPS.POLICE.JAIL.JAIL_PERSON.JAIL_WITH_INCIDENT"),color:"red",cb:()=>{if(!e.sentence||!e.description){setTimeout(()=>{N.PopUp.set({title:i("APPS.POLICE.JAIL.ERROR.TITLE"),description:i("APPS.POLICE.JAIL.ERROR.MISSING_DETAILS"),buttons:[{title:i("APPS.POLICE.OK")}]})},300),c("error","No sentence or description provided");return}M.set({type:"cases",onSelect:n=>{e.case={id:n.id,label:n.label},A({id:e.id,sentence:e.sentence,reason:e.description,case:e.case})}})}},{title:i("APPS.POLICE.JAIL.JAIL_PERSON.JAIL_WITHOUT_INCIDENT"),cb:()=>{if(!e.sentence||!e.description){setTimeout(()=>{N.PopUp.set({title:i("APPS.POLICE.JAIL.ERROR.TITLE"),description:i("APPS.POLICE.JAIL.ERROR.MISSING_DETAILS"),buttons:[{title:i("APPS.POLICE.OK")}]})},300),c("error","No sentence or description provided");return}A({id:e.id,sentence:e.sentence,reason:e.description})}}]})},A=n=>{if(!n.id)return c("error","No id provided");if(!n.reason&&n.reason.length>10)return c("error","No reason provided / reason is below 10 characters");if(!n.sentence&&n.sentence>0)return c("error","No sentence provided / sentence is below 0");h("Police",{action:"jailPlayer",data:{id:n.id,description:n.reason,case:n.case,sentence:n.sentence}},!0).then(P=>{if(!P)return c("error","Failed to jail person");c("info","Successfully jailed person")})}};return k("police:newPrisoner",e=>{if(!e)return c("error","No data received for police:newPrisoner");L.set([e,...L.value])}),k("police:prisonerReleased",e=>{if(!e)return c("error","No data received for police:prisonerReleased");L.set(L.value.filter(d=>d.id!==e))}),s(b.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:o?s(V,{children:s(X,{})}):s("main",{className:"main profiles",children:a("div",{className:"page",children:[a("div",{className:"top",children:[s("div",{className:"title",children:i("APPS.POLICE.JAIL.TITLE")}),((g=u==null?void 0:u.jail)==null?void 0:g.create)&&a("div",{className:"button",onClick:l,children:[s(U,{}),i("APPS.POLICE.ADD")]})]}),s(B,{placeholder:i("APPS.POLICE.JAIL.SEARCH"),onChange:e=>T(e.target.value)}),a("div",{className:"items",onScroll:f,children:[t.length===0&&r.length==0&&s("div",{className:"no-results",children:i("APPS.POLICE.SEARCH_FOR",{query:i("APPS.POLICE.JAIL.JAILED_PERSON").toLowerCase()})}),t.length===0&&r.length>0&&s("div",{className:"no-results",children:i("APPS.POLICE.NO_RESULTS_FOR",{query:r})}),t.map((e,d)=>{let A=d===t.length-1?"last":"";return a(b.div,{...G,id:A,className:"item",onClick:()=>J(e.id),children:[s("img",{src:w(e.avatar,"profile")}),a("div",{className:"info",children:[s("div",{className:"name",children:e.name}),s("div",{className:"subtitle",children:e.description.substring(0,150)}),a("div",{className:"cards",children:[e.case&&a(F,{children:[a("div",{className:"card blue clickable",onClick:n=>{n.stopPropagation(),h("Police",{action:"getIncident",id:e.case.id},R.cases.find(P=>P.id===e.case.id)).then(P=>{if(!P)return c("error","Failed to fetch incident");D.set(P),x.set("cases")})},children:[e.case.label," (",e.case.id,")"]}),s("div",{className:"divider"})]}),s("div",{className:"card blue",children:i("APPS.POLICE.JAIL.JAILED_BY_NAME",{name:e==null?void 0:e.jailedBy})}),s("div",{className:"card red",children:i("APPS.POLICE.JAIL.REMAINING_TIME_DATE",{time:j(e.remainingTime),date:y(e.releasedAt)})})]})]})]},d)})]})]})})})}const X=()=>{var v,p,f,J;const t=S(I),o=S(Q),u=S(K.APPS.POLICE.permissions),[r,O]=E.useState(!1),C=E.useRef(!1),T=()=>{if(!C.current){c("info","No changes have been made to the incident"),D.reset();return}h("Police",{action:"updateJailee",data:{id:t.id,description:t.description,case:t.case}}).then(l=>{})},_=()=>{N.PopUp.set({title:i("APPS.POLICE.JAIL.UNJAIL_PERSON.TITLE"),description:i("APPS.POLICE.JAIL.UNJAIL_PERSON.DESCRIPTION",{name:t==null?void 0:t.name}),buttons:[{title:i("APPS.POLICE.CANCEL")},{title:i("APPS.POLICE.JAIL.UNJAIL_PERSON.PROCEED"),color:"red",cb:()=>{h("Police",{action:"unjail",id:t.id},!0).then(l=>{if(!l)return c("error","Failed to unjail person");L.set(L.value.filter(g=>g.id!==t.id)),I.reset()})}}]})};let m=E.useRef(!0);return E.useEffect(()=>{if(t){if(m.current){m.current=!1;return}C.current=!0}},[t]),s(b.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{ease:"easeInOut",duration:.25},className:"grid-container",children:t&&a(F,{children:[a("div",{className:"grid-header",children:[a("div",{className:"back",onClick:()=>I.reset(),children:[s(W,{})," ",i("APPS.POLICE.BACK")]}),a("div",{className:"buttons",children:[((v=u.jail)==null?void 0:v.unjail)&&((f=(p=o==null?void 0:o.Police)==null?void 0:p.Jail)==null?void 0:f.CanUnjail)&&!r&&s("div",{className:"button red",onClick:_,children:i("APPS.POLICE.JAIL.UNJAIL")}),r&&s("div",{className:"button red",onClick:()=>O(!1),children:i("APPS.POLICE.CANCEL")}),((J=u==null?void 0:u.jail)==null?void 0:J.edit)&&s("div",{className:"button",onClick:()=>{r?T():O(!0)},children:r?i("APPS.POLICE.SAVE"):i("APPS.POLICE.EDIT")})]})]}),a("div",{className:"grid-body",style:{gridTemplateAreas:`
                                'profile profile'
                                'description reports'
                                'description .'
                         `,overflowY:"auto",paddingBottom:"2rem"},children:[a("div",{className:"grid-item",style:{gridArea:"profile"},children:[s("div",{className:"top",children:s("div",{className:"title",children:i("APPS.POLICE.JAIL.PROFILE")})}),s("div",{className:"items",children:a("div",{className:"item profile",children:[a("div",{className:"left",children:[s("div",{className:"mugshot",children:s("img",{src:w(t.avatar,"profile"),onClick:()=>{t.avatar&&N.FullscreenImage.set(t.avatar)}})}),s("div",{className:"info",children:s("div",{className:"name",children:t.name})})]}),a("div",{className:"details",children:[a("div",{className:"item",children:[s("span",{children:i("APPS.POLICE.JAIL.JAILED_BY")}),s("div",{className:"value",children:t.jailedBy})]}),a("div",{className:"item",children:[s("span",{children:i("APPS.POLICE.JAIL.JAILED_AT")}),s("div",{className:"value",children:y(t.jailedAt)})]}),a("div",{className:"item",children:[s("span",{children:i("APPS.POLICE.JAIL.REMAINING_TIME")}),s("div",{className:"value",children:j(t.remainingTime)})]}),a("div",{className:"item",children:[s("span",{children:i("APPS.POLICE.JAIL.ORIGINAL_SENTENCE")}),s("div",{className:"value",children:j(t.originalTime)})]}),a("div",{className:"item",children:[s("span",{children:i("APPS.POLICE.JAIL.RELEASE_DATE")}),s("div",{className:"value",children:y(t.releasedAt)})]})]})]})})]}),a("div",{className:"grid-item",style:{gridArea:"description",height:"20vh"},children:[s("div",{className:"top",children:s("div",{className:"title",children:i("APPS.POLICE.JAIL.DESCRIPTION")})}),s("div",{className:"items",children:s(Y,{className:"note",placeholder:i("APPS.POLICE.JAIL.DESCRIPTION_PLACEHOLDER"),defaultValue:t.description,disabled:!r,onChange:l=>I.patch({description:l.target.value}),style:{height:"100%"}})})]}),a("div",{className:"grid-item",style:{gridArea:"reports"},children:[a("div",{className:"top",children:[s("div",{className:"title",children:i("APPS.POLICE.JAIL.LINKED_CASE")}),r&&a(b.div,{...z,className:"button",onClick:()=>{M.set({type:"cases",onSelect:l=>{I.set({...I.value,case:{id:l.id,label:l.label}})}})},children:[s(U,{}),i("APPS.POLICE.ADD")]})]}),a("div",{className:"items",children:[!t.case&&s("div",{className:"no-results",children:i("APPS.POLICE.JAIL.NO_LINKED_CASE")}),s("div",{className:"cards",children:t.case&&a("div",{className:$("card blue clickable"),onClick:()=>{r?N.PopUp.set({title:i("APPS.POLICE.JAIL.REMOVE_LINKED_CASE.TITLE"),description:i("APPS.POLICE.JAIL.REMOVE_LINKED_CASE.DESCRIPTION"),buttons:[{title:i("APPS.POLICE.CANCEL")},{title:i("APPS.POLICE.REMOVE"),color:"red",cb:()=>{I.set({...I.value,case:null})}}]}):h("Police",{action:"getIncident",id:t.case.id},R.cases.find(l=>l.id===t.case.id)).then(l=>{if(!l)return c("error","Failed to fetch incident");D.set(l),x.set("cases")})},children:[t.case.label," (",t.case.id,")"]})})]})]})]})]})})},j=t=>{if(!t)return i("APPS.POLICE.MISC.UNKNOWN");if(t<0)return i("APPS.POLICE.JAIL.RELEASED");if(t<3600){const o=Math.floor(t/60);return o<1?i("APPS.POLICE.JAIL.LESS_THAN_MINUTE"):i("APPS.POLICE.MISC.MINUTES",{minutes:o.toString()})}if(t<86400){const o=Math.floor(t/3600);return i("APPS.POLICE.MISC.HOURS",{hours:o.toString()})}return i("APPS.POLICE.MISC.DAYS",{days:Math.floor(t/86400).toString()})};export{ee as default};
