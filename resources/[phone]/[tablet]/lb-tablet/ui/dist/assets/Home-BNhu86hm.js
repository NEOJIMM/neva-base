import{j as s,m as g,a as u,K as v,u as L,r as E,h,G as d,L as n,o as I,H as b,bf as T,a8 as f,k as O,g as P,aD as _,bJ as k,$ as U}from"./index-B-vcvQz_.js";import{A as M,a as R,V as H,M as y,U as x}from"./Ambulance-Dl73Nu8C.js";const D=v([]),A=v([]),B=v([]),F=(e,l)=>{switch(e){case"getReport":return M.reports.find(a=>a.id===l);default:return null}},$=(e,l)=>{if(!l)return d("error","No ID provided");h("Ambulance",{action:e,id:l},F(e,l)).then(a=>{if(!a)return d("error",`Failed to fetch  ${e} with ID: ${l}`);switch(e){case"getReport":R.set(a),H.set("reports");break}})};function K(){return s(g.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{ease:"easeInOut",duration:.25},className:"policepage-container",children:s("main",{className:"main",style:{padding:"0"},children:u("div",{className:"grid",children:[s(j,{}),s(V,{}),s(z,{})]})})})}const j=()=>{var m;const e=L(D),l=L(U.APPS.AMBULANCE.permissions),[a,t]=E.useState(""),[o,p]=E.useState("");return E.useEffect(()=>{const r=setTimeout(()=>t(o),500);return()=>clearTimeout(r)},[o]),E.useEffect(()=>{h("Ambulance",{action:"getReports",query:a},M.reports.filter(r=>r.title.toLowerCase().includes(a.toLowerCase())||r.description.toLowerCase().includes(a.toLowerCase()))).then(r=>{if(!r)return d("warning","getReports did not return any data");D.set(r)})},[a]),u("div",{className:"grid-item full",children:[u("div",{className:"top",children:[s("div",{className:"title",children:n("APPS.AMBULANCE.HOME.RECENT_REPORTS")}),((m=l==null?void 0:l.report)==null?void 0:m.create)&&u("div",{className:"button",onClick:()=>{R.set({}),H.set("reports")},children:[s(I,{}),n("APPS.AMBULANCE.HOME.CREATE")]})]}),s(b,{placeholder:n("APPS.AMBULANCE.REPORTS.SEARCH"),onChange:r=>p(r.target.value)}),s("div",{className:"items",children:e.map(r=>s(g.div,{...T,className:"item home",onClick:()=>$("getReport",r.id),children:u("div",{className:"item-content",children:[s("div",{className:"item-title",children:r.title}),s("div",{className:"item-subtitle",children:r.description.length>100?r.description.substring(0,100)+"...":r.description}),s("div",{className:"item-footer",children:n("APPS.AMBULANCE.HOME.REPORT_FOOTER",{timestamp:f(r.lastUpdated),author:r.author})})]})},r.id))})]})},V=()=>{var r;const e=L(x),l=L(A),a=L(U.APPS.AMBULANCE.permissions),[t,o]=E.useState(""),[p,m]=E.useState("");return E.useEffect(()=>{const i=setTimeout(()=>o(p),500);return()=>clearTimeout(i)},[p]),E.useEffect(()=>{h("Ambulance",{action:"getBulletinBoard",query:t},M.bulletinBoard.filter(i=>i.title.toLowerCase().includes(t.toLowerCase())||i.content.toLowerCase().includes(t.toLowerCase()))).then(i=>{if(!i)return d("warning","getBulletinBoard did not return any data");A.set(i)})},[t]),O("ambulance:bulletinDeleted",i=>{if(!i)return d("error","No ID provided in bulletinDeleted event");A.set(A.value.filter(c=>c.id!==i))}),u("div",{className:"grid-item full",children:[u("div",{className:"top",children:[s("div",{className:"title",children:n("APPS.AMBULANCE.HOME.BULLETIN_BOARD")}),((r=a==null?void 0:a.bulletin)==null?void 0:r.create)&&u("div",{className:"button",onClick:()=>{let i,c;P.PopUp.set({title:n("APPS.AMBULANCE.HOME.ADD_BULLETIN.TITLE"),description:n("APPS.AMBULANCE.HOME.ADD_BULLETIN.DESCRIPTION"),input:{placeholder:n("APPS.AMBULANCE.HOME.ADD_BULLETIN.PLACEHOLDER"),onChange:N=>{P.PopUp.value.buttons[0].disabled=N.length<1,i=N}},textarea:{placeholder:n("APPS.AMBULANCE.HOME.ADD_BULLETIN.CONTENT"),onChange:N=>{P.PopUp.value.buttons[0].disabled=N.length<1,c=N}},buttons:[{title:n("APPS.AMBULANCE.HOME.ADD_BULLETIN.CANCEL")},{title:n("APPS.AMBULANCE.HOME.ADD_BULLETIN.PROCEED"),cb:()=>{if(!i||!c)return d("error","Input or Textarea is empty");if(i.length<1||c.length<1)return d("error","Input or Textarea is empty");h("Ambulance",{action:"createBulletin",title:i,content:c},Math.random().toString(36).substring(7)).then(N=>{if(!N)return d("error","Failed to create bulletin");let w=[...A.value,{id:N,title:i,content:c,timestamp:Date.now(),author:e.name,pinned:!1}].sort((C,S)=>C.timestamp===S.timestamp?0:C.timestamp>S.timestamp?-1:1).sort((C,S)=>C.pinned===S.pinned?0:C.pinned?-1:1);A.set(w)})}}]})},children:[s(I,{}),n("APPS.AMBULANCE.ADD")]})]}),s(b,{placeholder:n("APPS.AMBULANCE.HOME.SEARCH_BULLETIN"),onChange:i=>m(i.target.value)}),s("div",{className:"items full",children:l.sort((i,c)=>i.timestamp===c.timestamp?0:i.timestamp>c.timestamp?-1:1).sort((i,c)=>i.pinned===c.pinned?0:i.pinned?-1:1).filter(i=>i.title.toLowerCase().includes(t.toLowerCase())||i.content.toLowerCase().includes(t.toLowerCase())).map((i,c)=>s(q,{data:i},c))})]})},q=({data:e})=>{const l=_(()=>{var a,t,o;!((a=U.APPS.AMBULANCE.permissions.value)!=null&&a.bulletin.pin)&&!(e!=null&&e.created)||P.ContextMenu.set({buttons:[((t=U.APPS.AMBULANCE.permissions.value)==null?void 0:t.bulletin.pin)&&{title:e.pinned?n("APPS.AMBULANCE.HOME.UNPIN"):n("APPS.AMBULANCE.HOME.PIN"),color:e.pinned?"red":null,cb:()=>{h("Ambulance",{action:"toggleBulletinPinned",id:e.id,pinned:!e.pinned},!0).then(p=>{if(!p)return d("error","Failed to toggle pinned bulletin");A.set(A.value.map(m=>m.id===e.id?{...m,pinned:!m.pinned}:m))})}},(e.created||((o=U.APPS.AMBULANCE.permissions.value)==null?void 0:o.bulletin.delete))&&{title:n("APPS.AMBULANCE.HOME.DELETE_BULLETIN.DELETE"),color:"red",cb:()=>{P.PopUp.set({title:n("APPS.AMBULANCE.HOME.DELETE_BULLETIN.TITLE"),description:n("APPS.AMBULANCE.HOME.DELETE_BULLETIN.DESCRIPTION"),buttons:[{title:n("APPS.AMBULANCE.CANCEL")},{title:n("APPS.AMBULANCE.DELETE"),color:"red",cb:()=>{h("Ambulance",{action:"deleteBulletin",id:e.id}).then(p=>{if(!p)return d("error","Failed to delete bulletin");A.set(A.value.filter(m=>m.id!==e.id))})}}]})}}]})});return s(g.div,{...T,...l,className:"item home",onClick:()=>{y.set({title:e.title,content:e.content,footer:`${f(e.timestamp)} - ${e.author}`})},children:u("div",{className:"item-content",children:[e.pinned&&s(k,{}),s("div",{className:"item-title",children:e.title}),s("div",{className:"item-subtitle",children:e.content}),u("div",{className:"item-footer",children:[f(e.timestamp)," - ",e.author]})]})})},z=()=>{const e=L(B),[l,a]=E.useState("");return E.useEffect(()=>{h("Ambulance",{action:"getActiveUnits"},M.activeUnits).then(t=>{if(!t)return d("warning","getActiveUnits did not return any data");B.set(t)})},[]),O("ambulance:updateCallsign",t=>{if(!t)return d("error","No data received for ambulance:updateCallsign");B.set(B.value.map(o=>o.source===t.source?{...o,callsign:t.callsign}:o))}),u("div",{className:"grid-item full",children:[s("div",{className:"top",children:s("div",{className:"title",children:n("APPS.AMBULANCE.HOME.ACTIVE_UNITS")})}),s(b,{placeholder:n("APPS.AMBULANCE.HOME.SEARCH_UNITS"),onChange:t=>a(t.target.value)}),s("div",{className:"items full",children:e.filter(t=>{var o;return((o=t==null?void 0:t.callsign)==null?void 0:o.toLowerCase().includes(l.toLowerCase()))||(t==null?void 0:t.name.toLowerCase().includes(l.toLowerCase()))}).map((t,o)=>u(g.div,{...T,className:"item unit",children:[t.callsign&&s("div",{className:"card green",children:t.callsign}),s("div",{className:"card red",children:t.rank}),s("div",{className:"name",children:t.name})]},o))})]})};export{K as default};
